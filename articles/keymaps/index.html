<!DOCTYPE html><html lang=en-US><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Remapping Keys on macOS High Sierra | Keystroke Countdown</title><meta name=author content="[object Object]"><meta name=robots content="index, follow"><meta name=HandheldFriendly content=True><meta name=description content="Short discussion on how I remapped the keys on my MacBook Pro w/ an international layout."><link rel=author href=/humans.txt><link rel=icon type=image/png href=/images/favicon.png><link rel=stylesheet href=/css/all-219136742a6fdee2bdc61d07f9ed89cc.css></head><body class="post-template nav-closed"><div class="nav nav-closed" id=nav><h3 class=nav-title>Menu</h3><a href=# class=nav-close><span class=hidden>Close</span></a><ul class=nav-list><li class=nav-home role=presentation><a href=/ ><i class="fa fa-home" aria-hidden=true></i> Home</a></li><li class=nav-home role=presentation><a href=/about><i class="fa fa-info-circle" aria-hidden=true></i> About Me</a></li><li class=nav-nome role=presentation><a href=/rss.xml><i class="fa fa-rss" aria-hidden=true></i> Subscribe</a> <a href="https://validator.w3.org/feed/check.cgi?url=https%3A//keystrokecountdown.com/rss.xml"><img src=/images/valid-rss-rogers.png alt="[Valid RSS]" title="Validate my RSS feed"></a></li><li class=nav-home role=presentation><a href=/topics><i class="fa fa-tags" aria-hidden=true></i> Topics</a></li><br><li class=nav-home role=presentation><a href=/articles/auv3/index.html>AUv3 Development -- Part 1 of N</a></li><li class=nav-home role=presentation><a href=/articles/knobci/index.html>Swift Snapshot Testing in Github Actions</a></li><li class=nav-home role=presentation><a href=/articles/wma/index.html>Converting WMA Files to MP3</a></li><li class=nav-home role=presentation><a href=/articles/remarkable/index.html>Remarkable Customizations</a></li><li class=nav-home role=presentation><a href=/articles/browsers/index.html>Automatic Browser Selection</a></li><li class=nav-home role=presentation><a href=/articles/genart/index.html>Generative Images with SVG.js</a></li><li class=nav-home role=presentation><a href=/articles/logistic/index.html>Simple Image Classification using Logistic Regression</a></li><li class=nav-home role=presentation><a href=/articles/kerberos/index.html>Using Kerboros on macOS</a></li><li class=nav-home role=presentation><a href=/articles/translate/index.html>Text Language Translation Utility</a></li><li class=nav-home role=presentation><a href=/articles/keymaps/index.html>Remapping Keys on macOS High Sierra</a></li><li class=nav-home role=presentation><a href=/articles/letencrypt/index.html>Fixing Azure Let&#x27;s Encrypt Expired Key</a></li><li class=nav-home role=presentation><a href=/articles/console/index.html>Formatting Console Output</a></li><li class=nav-home role=presentation><a href=/articles/layout/index.html>[DRAFT] Test Page for CSS Settings</a></li><li class=nav-home role=presentation><a href=/articles/docker/index.html>[DRAFT] Playing with .Net Core Apps and Docker on a Mac</a></li><li class=nav-home role=presentation><a href=/articles/autohotkey/index.html>Different (Key)strokes for Different Folks</a></li><li class=nav-home role=presentation><a href=/articles/itunes/index.html>Apple iTunes Library Manipulation with Python</a></li><li class=nav-home role=presentation><a href=/articles/metalsmith2/index.html>Metalsmith Plugins for Server-side KaTeX Processing</a></li><li class=nav-home role=presentation><a href=/articles/poisson/index.html>Arrival Intervals of a Poisson Process</a></li><li class=nav-home role=presentation><a href=/articles/cocoapods/index.html>Framework Bundles in Xcode and CocoaPods</a></li><li class=nav-home role=presentation><a href=/articles/signing/index.html>Signing Embedded Frameworks in an Embedded Framework</a></li><li class=nav-home role=presentation><a href=/articles/vhtc/index.html>Variable Height UITableView Cells in Swift</a></li><li class=nav-home role=presentation><a href=/articles/joystick/index.html>JoyStickView for iOS in Swift</a></li><li class=nav-home role=presentation><a href=/articles/dependencyInjection/index.html>Dependency Injection for iOS in Swift</a></li><li class=nav-home role=presentation><a href=/articles/corePlot/index.html>Working with Core Plot</a></li><li class=nav-home role=presentation><a href=/articles/slidingViews/index.html>Sliding UIViews with Core Animation</a></li><li class=nav-home role=presentation><a href=/articles/swiftCollection/index.html>Adding Binary Search to Swift Collections</a></li><li class=nav-home role=presentation><a href=/articles/metalsmith/index.html>Metalsmith Static Site on Azure</a></li><li class=nav-home role=presentation><a href=/articles/bloom/index.html>Bloom Filters in Python</a></li><li class=nav-home role=presentation><a href="/articles/Testing IPython/testing-ipython.html">Testing IPython</a></li><li class=nav-home role=presentation><a href=/articles/decrypt/index.html>Decrypting Logs in Python</a></li><li class=nav-home role=presentation><a href=/articles/power/index.html>Power of Optimal Algorithm Design</a></li><li class=nav-home role=presentation><a href=/articles/PDMPlayground/index.html>PDM Playground</a></li><li class=nav-home role=presentation><a href=/articles/bscope/index.html>B-Scope Radar Display</a></li><li class=nav-home role=presentation><a href=/articles/ascope/index.html>A-Scope Signal Display</a></li><li class=nav-home role=presentation><a href=/articles/radardisplay/index.html>Radar Display</a></li><li class=nav-home role=presentation><a href=/articles/dfwtraffic/index.html>Visualizing Traffic at DFW Airport</a></li></ul></div><span class=nav-cover></span><div class=site-wrapper><header class="main-header post-head" style="background-image: url(/images/computer-keyboard-stones-on-grass-background-header.jpg)"><nav class="main-nav overlay clearfix"><a class="menu-button icon-menu" href=#><span class=word>Menu</span></a></nav></header><main class=content role=main><article class=post><header class=post-header><h1 class=post-title><a href=/ >Remapping Keys on macOS High Sierra</a></h1><section class=post-meta><time class=post-date datetime="Fri Apr 06 2018 11:06:00 GMT+0200 (Central European Summer Time)">Apr 6th, 2018</time> <a class=post-date href=/topics><i class="fa fa-tags" aria-hidden=true></i></a> <a class=post-date href=/topics/macos.html>macOS (3)</a></section></header><section class=post-content><p>When I joined Criteo, I was given a brand new MacBook Pro, the one with the Touch Bar and the less-than-stellar keyboard. I’m still getting used to the keys, but the biggest problem was that contrary to my expressed wishes, I received an international key layout, with keys like so:</p><p><img src=intl_960.jpg title="" srcset="intl_480.jpg 480w,intl_650.jpg 650w,intl_960.jpg 960w,intl_1440.jpg 1440w" sizes="(min-width: 960px) 960px, calc(100vw-6rem)"></p><p>I have never had the need to type a “§” or a “±” in my life, so that key in the upper-left corner is completely useless to me. Worse, it occupies a place where I would normally type a “`” or a “~” – characters that are useful in my typing at work and in Markdown text like this blog entry.</p><p>I’ve done remapping before on macOS, in particular to make typing in Czech much easier without having to resort to switching to a Czech keyboard layout. I used the program <a href="http://scripts.sil.org/cms/scripts/page.php?site_id=nrsi&amp;id=ukelele">Ukelele</a> to do the necessary configury to get the necessary diacritics for vowels that are pretty common in Czech.</p><p>However, starting with macOS 10.12 Sierra, Apple made some major changes to how key remapping takes place – for the better in my opinion. I can now perform major remapping of key codes instead of just tweaking <em>dead keys</em> like I was doing with Ukelele. I am now able to restore the “`” / “~” key to its proper place, and improve my touch typing with my left hand while using this laptop.</p><p>The utility to accomplish this is called <code>hidutil</code>. It is briefly described in an <a href=https://developer.apple.com/library/content/technotes/tn2450/_index.html>Apple Technical Note</a>. I wrote a short Bash script to help with the formatting of parameters it takes.</p><pre class=language-bash><code class=language-bash><span class="token assign-left variable">FROM</span><span class="token operator">=</span><span class="token string">'"HIDKeyboardModifierMappingSrc"'</span>
<span class="token assign-left variable">TO</span><span class="token operator">=</span><span class="token string">'"HIDKeyboardModifierMappingDst"'</span>

<span class="token assign-left variable">ARGS</span><span class="token operator">=</span><span class="token string">""</span>
<span class="token keyword">function</span> Map <span class="token comment"># FROM TO</span>
<span class="token punctuation">{</span>
    <span class="token assign-left variable">CMD</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${CMD<span class="token operator">:+</span>${CMD}</span>,}{<span class="token variable">${FROM}</span>: <span class="token variable">${1}</span>, <span class="token variable">${TO}</span>: <span class="token variable">${2}</span>}"</span>
<span class="token punctuation">}</span>

<span class="token assign-left variable">BACKQUOTE</span><span class="token operator">=</span><span class="token string">"0x700000035"</span>
<span class="token assign-left variable">SHIFT_LOCK</span><span class="token operator">=</span><span class="token string">"0x700000039"</span>
<span class="token assign-left variable">SECTION</span><span class="token operator">=</span><span class="token string">"0x700000064"</span>
<span class="token assign-left variable">L_SHIFT</span><span class="token operator">=</span><span class="token string">"0x7000000E1"</span>
<span class="token assign-left variable">R_COMMAND</span><span class="token operator">=</span><span class="token string">"0x7000000E7"</span>
<span class="token assign-left variable">L_CONTROL</span><span class="token operator">=</span><span class="token string">"0x7000000E0"</span>

Map <span class="token variable">${SECTION}</span> <span class="token variable">${BACKQUOTE}</span>
Map <span class="token variable">${SHIFT_LOCK}</span> <span class="token variable">${L_SHIFT}</span>
Map <span class="token variable">${R_COMMAND}</span> <span class="token variable">${SHIFT_LOCK}</span>
Map <span class="token variable">${BACKQUOTE}</span> <span class="token variable">${L_CONTROL}</span>

hidutil property --set <span class="token string">"{<span class="token entity" title=\&quot;>\"</span>UserKeyMapping<span class="token entity" title=\&quot;>\"</span>:[<span class="token variable">${CMD}</span>]}"</span>
</code></pre><p>The script performs the following mapping:</p><ul><li>Map “§” to “`” (and “±” to “~” when shifted)</li><li>Make the <code>Caps Lock</code> key act like a <code>Shift</code> key</li><li>Make the right <code>Command</code> (⌘) key act like <code>Caps Lock</code></li><li>Make the key between <code>Shift</code> and “Z” act like a <code>Control</code> key</li></ul><p>The motivation for the additional mappings is to reduce the amount of mis-typed keys I while using Emacs. My muscle memory is highly tuned to Apple’s US keyboard layout, and I found myself prone to mistyping common Emacs chord sequences when using the international version. The mapping does help, but it is not perfect. However, the biggest source of errors – the badly placed “\” key – has no solution yet, and my right hand still suffers for it.</p><p>The <code>Map</code> function generates a mapping from one key code to another and appends it to previous mappings, all stored in the <code>CMD</code> variable. The contents of <code>CMD</code> are then used to generate a “UserKeyMapping” value for <code>hidutil</code> to consume.</p><p>This works great, but I need to run this every time I log in. To fix that, I created a short LaunchAgent configuration file that will run when logging in:</p><pre class=language-xml><code class=language-xml><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">plist</span> <span class="token name">PUBLIC</span> <span class="token string">"-//Apple Computer//DTD PLIST 1.0//EN"</span> <span class="token string">"http://www.apple.com/DTDs/PropertyList-1.0.dtd"</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plist</span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dict</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>key</span><span class="token punctuation">></span></span>Label<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>key</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">></span></span>com.user.loginscript<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>key</span><span class="token punctuation">></span></span>ProgramArguments<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>key</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>array</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">></span></span>/Users/howes/bin/remap<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>array</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>key</span><span class="token punctuation">></span></span>RunAtLoad<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>key</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>true</span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dict</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plist</span><span class="token punctuation">></span></span>
</code></pre><p>I then put that configuration file in <code>~/Library/LaunchAgents</code> directory. Now, my <code>remap</code> script runs every time I log in.</p></section><footer class=post-footer><figure class=author-image><a class=img href=https://keystrokecountdown.com style=background-image:url(/images/HarrisonsLaugh.png)><span class=hidden>Brad Howes's Picture</span></a></figure><section class=author><h4><a href=https://keystrokecountdown.com>Brad Howes</a></h4><p>Owner <a href=https://apps.apple.com/us/developer/b-ray-software/id430573224>B-Ray Software</a>. Programmer in C++, Swift, Python, Javascript and more. Started out doing punch cards in FORTRAN.</p><div class=author-meta><span class="author-location icon-location">Paris, France</span> <span class="author-link icon-link"><a href=http://linkedin.com/in/bradhowes>http://linkedin.com/in/bradhowes</a></span> <span class="author-link icon-feed"><a href=mailto:bradhowes@mac.com>&nbsp;Email Me</a></span></div></section><section class=share><h4>Share this page</h4><div class=social-icons><a class=icon-twitter href="https://twitter.com/intent/tweet?text=Remapping%20Keys%20on%20macOS%20High%20Sierra&amp;url=https%3A%2Fkeystrokecountdown.com%2Farticles%2Fkeymaps%2Findex.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;"><span class=hidden>Twitter</span> </a><a class=icon-feed href="mailto:bradhowes@mac.com?subject=Curiosity&body=https%3A%2Fkeystrokecountdown.com%2Farticles%2Fkeymaps%2Findex.html"><span class=hidden>Email</span></a></div></section></footer></article></main><aside class=read-next><a class=read-next-story style="background-image: url(/articles/letencrypt/computer-keyboard-stones-on-grass-background-header.jpg)" href=/articles/letencrypt/index.html><section class=post><h2>Fixing Azure Let&#x27;s Encrypt Expired Key</h2><div class=post-meta>Account of what I did to fix a broken Azure Let&#x27;s Encrypt web job</div></section></a><a class="read-next-story prev" style="background-image: url(/articles/translate/translate.png)" href=/articles/translate/index.html><section class=post><h2>Text Language Translation Utility</h2><div class=post-meta>Brief discussion of Node.js utility I use on macOS to translate text between French and English</div></section></a></aside><footer class="site-footer clearfix"><section class=copyright><a href=https://keystrokecountdown.com>Keystroke Countdown</a> &copy; <span id=copyrightYear>2018</span> Brad Howes — <a href=https://github.com/bradhowes/keystrokecountdown>Source</a></section></footer></div><script>(function () {
      var installClickHandlers = function () {
        var navElement = document.getElementById("nav");
    
        // The click handler just toggles classes to do the showing/hiding
        //
        var clickHandler = function(e) {
          document.body.classList.toggle("nav-opened");
          document.body.classList.toggle("nav-closed");
          if (navElement) {
            navElement.classList.toggle("nav-opened");
            navElement.classList.toggle("nav-closed");
          }
        };
    
        // Find elements we wish to tap for click events
        //
        var elements = Array.prototype.slice.call(
          document.querySelectorAll(".menu-button, .nav-cover, .nav-close"));
        if (elements && elements.length > 0) {
          elements.forEach(function (element) {
            element.addEventListener('click', clickHandler);
          });
        }
      };
    
      // When the document is finished loading, install event handlers to show/hide sidebar menu
      //
      window.document.addEventListener("DOMContentLoaded", function (event) {
        installClickHandlers();
    
        // Set the copyright year at the bottom of our pages
        //
        window.document.getElementById("copyrightYear").innerHTML = (new Date()).getFullYear();
      });
    })();</script></body></html>