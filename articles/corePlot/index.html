<!DOCTYPE html><html lang=en-US><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Working with Core Plot | Keystroke Countdown</title><meta name=author content="[object Object]"><meta name=robots content="index, follow"><meta name=HandheldFriendly content=True><meta name=description content="Shows how to add and control Core Plot graphs"><link rel=author href=/humans.txt><link rel=icon type=image/png href=/images/favicon.png><link rel=stylesheet href=/css/all-219136742a6fdee2bdc61d07f9ed89cc.css></head><body class="post-template nav-closed"><div class="nav nav-closed" id=nav><h3 class=nav-title>Menu</h3><a href=# class=nav-close><span class=hidden>Close</span></a><ul class=nav-list><li class=nav-home role=presentation><a href=/ ><i class="fa fa-home" aria-hidden=true></i> Home</a></li><li class=nav-home role=presentation><a href=/about><i class="fa fa-info-circle" aria-hidden=true></i> About Me</a></li><li class=nav-nome role=presentation><a href=/rss.xml><i class="fa fa-rss" aria-hidden=true></i> Subscribe</a> <a href="https://validator.w3.org/feed/check.cgi?url=https%3A//keystrokecountdown.com/rss.xml"><img src=/images/valid-rss-rogers.png alt="[Valid RSS]" title="Validate my RSS feed"></a></li><li class=nav-home role=presentation><a href=/topics><i class="fa fa-tags" aria-hidden=true></i> Topics</a></li><br><li class=nav-home role=presentation><a href=/articles/auv3/index.html>AUv3 Development -- Part 1 of N</a></li><li class=nav-home role=presentation><a href=/articles/knobci/index.html>Swift Snapshot Testing in Github Actions</a></li><li class=nav-home role=presentation><a href=/articles/wma/index.html>Converting WMA Files to MP3</a></li><li class=nav-home role=presentation><a href=/articles/remarkable/index.html>Remarkable Customizations</a></li><li class=nav-home role=presentation><a href=/articles/browsers/index.html>Automatic Browser Selection</a></li><li class=nav-home role=presentation><a href=/articles/genart/index.html>Generative Images with SVG.js</a></li><li class=nav-home role=presentation><a href=/articles/logistic/index.html>Simple Image Classification using Logistic Regression</a></li><li class=nav-home role=presentation><a href=/articles/kerberos/index.html>Using Kerboros on macOS</a></li><li class=nav-home role=presentation><a href=/articles/translate/index.html>Text Language Translation Utility</a></li><li class=nav-home role=presentation><a href=/articles/keymaps/index.html>Remapping Keys on macOS High Sierra</a></li><li class=nav-home role=presentation><a href=/articles/letencrypt/index.html>Fixing Azure Let&#x27;s Encrypt Expired Key</a></li><li class=nav-home role=presentation><a href=/articles/console/index.html>Formatting Console Output</a></li><li class=nav-home role=presentation><a href=/articles/layout/index.html>[DRAFT] Test Page for CSS Settings</a></li><li class=nav-home role=presentation><a href=/articles/docker/index.html>[DRAFT] Playing with .Net Core Apps and Docker on a Mac</a></li><li class=nav-home role=presentation><a href=/articles/autohotkey/index.html>Different (Key)strokes for Different Folks</a></li><li class=nav-home role=presentation><a href=/articles/itunes/index.html>Apple iTunes Library Manipulation with Python</a></li><li class=nav-home role=presentation><a href=/articles/metalsmith2/index.html>Metalsmith Plugins for Server-side KaTeX Processing</a></li><li class=nav-home role=presentation><a href=/articles/poisson/index.html>Arrival Intervals of a Poisson Process</a></li><li class=nav-home role=presentation><a href=/articles/cocoapods/index.html>Framework Bundles in Xcode and CocoaPods</a></li><li class=nav-home role=presentation><a href=/articles/signing/index.html>Signing Embedded Frameworks in an Embedded Framework</a></li><li class=nav-home role=presentation><a href=/articles/vhtc/index.html>Variable Height UITableView Cells in Swift</a></li><li class=nav-home role=presentation><a href=/articles/joystick/index.html>JoyStickView for iOS in Swift</a></li><li class=nav-home role=presentation><a href=/articles/dependencyInjection/index.html>Dependency Injection for iOS in Swift</a></li><li class=nav-home role=presentation><a href=/articles/corePlot/index.html>Working with Core Plot</a></li><li class=nav-home role=presentation><a href=/articles/slidingViews/index.html>Sliding UIViews with Core Animation</a></li><li class=nav-home role=presentation><a href=/articles/swiftCollection/index.html>Adding Binary Search to Swift Collections</a></li><li class=nav-home role=presentation><a href=/articles/metalsmith/index.html>Metalsmith Static Site on Azure</a></li><li class=nav-home role=presentation><a href=/articles/bloom/index.html>Bloom Filters in Python</a></li><li class=nav-home role=presentation><a href="/articles/Testing IPython/testing-ipython.html">Testing IPython</a></li><li class=nav-home role=presentation><a href=/articles/decrypt/index.html>Decrypting Logs in Python</a></li><li class=nav-home role=presentation><a href=/articles/power/index.html>Power of Optimal Algorithm Design</a></li><li class=nav-home role=presentation><a href=/articles/PDMPlayground/index.html>PDM Playground</a></li><li class=nav-home role=presentation><a href=/articles/bscope/index.html>B-Scope Radar Display</a></li><li class=nav-home role=presentation><a href=/articles/ascope/index.html>A-Scope Signal Display</a></li><li class=nav-home role=presentation><a href=/articles/radardisplay/index.html>Radar Display</a></li><li class=nav-home role=presentation><a href=/articles/dfwtraffic/index.html>Visualizing Traffic at DFW Airport</a></li></ul></div><span class=nav-cover></span><div class=site-wrapper><header class="main-header post-head" style="background-image: url(/articles/corePlot/animation.gif)"><nav class="main-nav overlay clearfix"><a class="menu-button icon-menu" href=#><span class=word>Menu</span></a></nav></header><main class=content role=main><article class=post><header class=post-header><h1 class=post-title><a href=/ >Working with Core Plot</a></h1><section class=post-meta><time class=post-date datetime="Wed Sep 28 2016 17:18:02 GMT+0200 (Central European Summer Time)">Sep 28th, 2016</time> <a class=post-date href=/topics><i class="fa fa-tags" aria-hidden=true></i></a> <a class=post-date href=/topics/coreplot.html>CorePlot (1)</a> • <a class=post-date href=/topics/swift.html>Swift (10)</a> • <a class=post-date href=/topics/ui.html>UI (5)</a></section></header><section class=post-content><p>For fun, I’ve been rewriting an app I had created on iOS for measuring push notification performance. The original was written in Objective-C (Obj-C), but the rewrite is in Swift. The application uses <a href=https://github.com/core-plot/core-plot>Core Plot</a> for visualizing, and much of my work so far has focused on getting the plots to look and work right. Revisiting my code brought back memories of the difficulties I encountered getting desired behavior out of the complex library (the generated documentation helps somewhat as do the demo apps, but I often need to dive into Core Plot code to get the desired behavior) this in another post).</p><p>Below is the main view of my app. The top graph shows the relative times when a notification arrives at the device (X axis) and the amount of latency – known or calculated – between the sending of the notification and its arrival.</p><p><img src=animationUpper.gif alt=animationUpper.gif></p><p>There are actually <em>four</em> plots in the upper view:</p><ul><li>Scatter plot of latency values over time (light blue connected dots)</li><li>Average latency value (plotted as yellow line)</li><li>Median latency value (plotted as magenta line)</li><li>Missing data (shown as shaded red regions)</li></ul><p>I’ll walk through how each of these is displayed.</p><h2>Graphing Environment Setup</h2><p>The main element in the view is a <code>CPTXYGraph</code> instance. It defines much of the graphing environment, including the axis and grid lines. For the most part, default settings will get you going, but I’m going to describe what changes I made to get the effect I wanted.</p><p>First, the placement of the <code>CPTXYGraph</code> within the hosting view:</p><pre class=language-swift><code class=language-swift><span class="token keyword">let</span> graph <span class="token operator">=</span> <span class="token class-name">CPTXYGraph</span><span class="token punctuation">(</span>frame<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>frame<span class="token punctuation">)</span>
hostedGraph <span class="token operator">=</span> graph

graph<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token class-name">CPTColor</span><span class="token punctuation">.</span><span class="token function">black</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cgColor
graph<span class="token punctuation">.</span>zPosition <span class="token operator">=</span> <span class="token number">1_000</span>

graph<span class="token punctuation">.</span>paddingLeft <span class="token operator">=</span> <span class="token number">0.0</span>
graph<span class="token punctuation">.</span>paddingRight <span class="token operator">=</span> <span class="token number">0.0</span>
graph<span class="token punctuation">.</span>paddingTop <span class="token operator">=</span> <span class="token number">0.0</span>
graph<span class="token punctuation">.</span>paddingBottom <span class="token operator">=</span> <span class="token number">0.0</span>

graph<span class="token punctuation">.</span>plotAreaFrame<span class="token operator">?</span><span class="token punctuation">.</span>masksToBorder <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
graph<span class="token punctuation">.</span>plotAreaFrame<span class="token operator">?</span><span class="token punctuation">.</span>borderLineStyle <span class="token operator">=</span> <span class="token nil constant">nil</span>
graph<span class="token punctuation">.</span>plotAreaFrame<span class="token operator">?</span><span class="token punctuation">.</span>cornerRadius <span class="token operator">=</span> <span class="token number">0.0</span>
graph<span class="token punctuation">.</span>plotAreaFrame<span class="token operator">?</span><span class="token punctuation">.</span>paddingTop <span class="token operator">=</span> <span class="token number">0.0</span>
graph<span class="token punctuation">.</span>plotAreaFrame<span class="token operator">?</span><span class="token punctuation">.</span>paddingLeft <span class="token operator">=</span> <span class="token number">22.0</span>
graph<span class="token punctuation">.</span>plotAreaFrame<span class="token operator">?</span><span class="token punctuation">.</span>paddingBottom <span class="token operator">=</span> <span class="token number">35.0</span>
graph<span class="token punctuation">.</span>plotAreaFrame<span class="token operator">?</span><span class="token punctuation">.</span>paddingRight <span class="token operator">=</span> <span class="token number">4.0</span>
</code></pre><p>The <code>padding…</code> properties are offsets from the bounds of the hosting view. I’ve set them to zero (0.0) here in order to use all available space. Next, there is the <code>plotAreaFrame</code> property, which defines the rectangle around the plotting area. Note that this excludes the axis. Since I do not want the plotting area to overlap with the X and Y axis areas, I set their padding to 35.0 and 22.0 respectively, values I came up with by trial and error.</p><p>Next, we allocate a <code>CPTXYPlotSpace</code> and configure it. A plot space defines the transformation between plot values and display units in both X and Y. One can have more than one plot space to support multiple transforms, though in my graph I only use one.</p><pre class=language-swift><code class=language-swift><span class="token keyword">let</span> plotSpace <span class="token operator">=</span> <span class="token class-name">CPTXYPlotSpace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
graph<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>plotSpace<span class="token punctuation">)</span>

plotSpace<span class="token punctuation">.</span>allowsUserInteraction <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token class-name">PlotSpace</span><span class="token punctuation">.</span>allowsMomentumX <span class="token operator">=</span> <span class="token boolean">true</span>
plotSpace<span class="token punctuation">.</span>xRange <span class="token operator">=</span> <span class="token class-name">CPTPlotRange</span><span class="token punctuation">(</span>locationDecimal<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> lengthDecimal<span class="token punctuation">:</span> <span class="token number">100.0</span><span class="token punctuation">)</span>
plotSpace<span class="token punctuation">.</span>yRange <span class="token operator">=</span> <span class="token class-name">CPTPlotRange</span><span class="token punctuation">(</span>locationDecimal<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> lengthDecimal<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">)</span>
</code></pre><p>The plot space also handles scrolling if enabled. This is done via the <code>allowsUserInteraction</code> property .</p><p>The <code>allowsMomentumX</code> property controls if scrolling momentum is in use. Momentum here means that scrolling will continue for a configurable amount of time after a finger movement</p><p>As mentioned, the plot space defines the coordinate transforms for the width and height of the graph. In the code above, I default them to some values which will at least show something even if there is no data to plot.</p><h2>Axis Configuration</h2><p>There are a veritable <em>ton</em> of properties one can tweak for an axis. Most of them are self-explanatory, but a few deserve some discussion.</p><pre class=language-swift><code class=language-swift>x<span class="token punctuation">.</span>labelOffset <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4.0</span>
x<span class="token punctuation">.</span>tickDirection <span class="token operator">=</span> <span class="token punctuation">.</span>negative
x<span class="token punctuation">.</span>labelFormatter <span class="token operator">=</span> <span class="token class-name">BRHTimeFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><p>By default, the tick labels for the X axis hang down quite a bit. I bring them closer to the axis by setting a negative offset value for <code>labelOffset</code>. Next, I have the ticks pointing down from the axis line instead of up by setting <code>tickDirection</code> to <code>.negative</code>. Finally, one can install a label generator. The class <code>BRHTimeFormatter</code> converts X values into time labels like <em>3m35s</em>.</p><p>For the Y axis, much of the setup is similar, though there are a few options specific to its vertical nature.</p><pre class=language-swift><code class=language-swift>y<span class="token punctuation">.</span>labelRotation <span class="token operator">=</span> <span class="token class-name">CGFloat</span><span class="token punctuation">(</span>M_PI_2<span class="token punctuation">)</span>
y<span class="token punctuation">.</span>axisConstraints <span class="token operator">=</span> <span class="token class-name">CPTConstraints</span><span class="token punctuation">(</span>lowerOffset<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">)</span>
</code></pre><p>I rotate the labels by 90° with <code>labelRotation</code> in order to minimize amount of margin I need for larger latency values. I also set <code>axisConstraints</code> to constrain the Y axis so that it is always drawn at the left hand of the plot, regardless of any scrolling in X. Remove this setting and one will have a Y axis that scrolls with the plots.</p><p>There are some additional settings involving grid lines and tick marks, but these are not very interesting – look at the code if curious.</p><p>Once the plot space is setup, we next create the four plots. The order in which they are added to the graph will determine the order in which they are drawn – a plot added after another will draw over anything drawn by previously-added plots.</p><h2>Missing Data Plot</h2><p>The missing data plot shows where gaps are in the timeline where a value was expected but did not arrive. We depict such gaps with a red rectangle, filled with a translucent red to reduce its intensity:</p><pre class=language-swift><code class=language-swift><span class="token keyword">let</span> plot <span class="token operator">=</span> <span class="token class-name">CPTScatterPlot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
plot<span class="token punctuation">.</span>identifier <span class="token operator">=</span> <span class="token class-name">GraphLatencyByTime</span><span class="token punctuation">.</span><span class="token constant">kMissingPlotId</span>
plot<span class="token punctuation">.</span>dataSource <span class="token operator">=</span> <span class="token keyword">self</span>
plot<span class="token punctuation">.</span>cachePrecision <span class="token operator">=</span> <span class="token punctuation">.</span>double
<span class="token keyword">let</span> lineStyle <span class="token operator">=</span> <span class="token class-name">CPTMutableLineStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
lineStyle<span class="token punctuation">.</span>lineJoin <span class="token operator">=</span> <span class="token punctuation">.</span>round
lineStyle<span class="token punctuation">.</span>lineCap <span class="token operator">=</span> <span class="token punctuation">.</span>round
lineStyle<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">1.0</span>
lineStyle<span class="token punctuation">.</span>lineColor <span class="token operator">=</span> <span class="token class-name">CPTColor</span><span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
plot<span class="token punctuation">.</span>dataLineStyle <span class="token operator">=</span> lineStyle
plot<span class="token punctuation">.</span>areaBaseValue <span class="token operator">=</span> <span class="token number">0.0</span>
plot<span class="token punctuation">.</span>areaFill <span class="token operator">=</span> <span class="token class-name">CPTFill</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token class-name">CPTColor</span><span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withAlphaComponent</span><span class="token punctuation">(</span><span class="token number">0.25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
graph<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>plot<span class="token punctuation">,</span> to<span class="token punctuation">:</span> plotSpace<span class="token punctuation">)</span>
</code></pre><p>Each plot has a unique identifier property. We will use these to select the right data for generating the plot, and to allow the user to selectively show/hide the plot by tapping on the plot’s legend entry. The rest of the configuration is pretty normal. Again, we use a small alpha for the area fill so as to not overwhelm the graph with the regions.</p><h2>Median and Average Latency Line Plots</h2><p>The median plot shows the historical median latency value. It is configured as expected for a line plot.</p><pre class=language-swift><code class=language-swift><span class="token keyword">let</span> plot <span class="token operator">=</span> <span class="token class-name">CPTScatterPlot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
plot<span class="token punctuation">.</span>identifier <span class="token operator">=</span> <span class="token class-name">GraphLatencyByTime</span><span class="token punctuation">.</span><span class="token constant">kMedianPlotId</span>
plot<span class="token punctuation">.</span>dataSource <span class="token operator">=</span> <span class="token keyword">self</span>
plot<span class="token punctuation">.</span>cachePrecision <span class="token operator">=</span> <span class="token punctuation">.</span>double
<span class="token keyword">let</span> lineStyle <span class="token operator">=</span> <span class="token class-name">CPTMutableLineStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
lineStyle<span class="token punctuation">.</span>lineJoin <span class="token operator">=</span> <span class="token punctuation">.</span>round
lineStyle<span class="token punctuation">.</span>lineCap <span class="token operator">=</span> <span class="token punctuation">.</span>round
lineStyle<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">3.0</span>
lineStyle<span class="token punctuation">.</span>lineColor <span class="token operator">=</span> <span class="token class-name">CPTColor</span><span class="token punctuation">.</span><span class="token function">magenta</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
plot<span class="token punctuation">.</span>dataLineStyle <span class="token operator">=</span> lineStyle
graph<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>plot<span class="token punctuation">,</span> to<span class="token punctuation">:</span> plotSpace<span class="token punctuation">)</span>
</code></pre><p>The average plot is the same except for the line color – yellow instead of magenta. The average value that is plotted represents a running average over all of the received values, while the median value is the middle value of a sliding window over the last N received values.</p><h2>Latency Scatter Plot</h2><p>For the last plot, we want to show the sample values as light blue dots, with thin gray lines connecting them.</p><pre class=language-swift><code class=language-swift><span class="token keyword">let</span> plot <span class="token operator">=</span> <span class="token class-name">CPTScatterPlot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
plot<span class="token punctuation">.</span>identifier <span class="token operator">=</span> <span class="token class-name">GraphLatencyByTime</span><span class="token punctuation">.</span><span class="token constant">kLatencyPlotId</span>
plot<span class="token punctuation">.</span>dataSource <span class="token operator">=</span> <span class="token keyword">self</span>
plot<span class="token punctuation">.</span>cachePrecision <span class="token operator">=</span> <span class="token punctuation">.</span>double
<span class="token keyword">let</span> lineStyle <span class="token operator">=</span> <span class="token class-name">CPTMutableLineStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
lineStyle<span class="token punctuation">.</span>lineJoin <span class="token operator">=</span> <span class="token punctuation">.</span>round
lineStyle<span class="token punctuation">.</span>lineCap <span class="token operator">=</span> <span class="token punctuation">.</span>round
lineStyle<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">1.0</span>
lineStyle<span class="token punctuation">.</span>lineColor <span class="token operator">=</span> <span class="token class-name">CPTColor</span><span class="token punctuation">.</span><span class="token function">gray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
plot<span class="token punctuation">.</span>dataLineStyle <span class="token operator">=</span> lineStyle
<span class="token keyword">let</span> symbolGradient <span class="token operator">=</span> <span class="token class-name">CPTGradient</span><span class="token punctuation">(</span>beginning<span class="token punctuation">:</span> <span class="token class-name">CPTColor</span><span class="token punctuation">(</span>componentRed<span class="token punctuation">:</span> <span class="token number">0.75</span><span class="token punctuation">,</span> green<span class="token punctuation">:</span> <span class="token number">0.75</span><span class="token punctuation">,</span> blue<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> alpha<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ending<span class="token punctuation">:</span> <span class="token class-name">CPTColor</span><span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
symbolGradient<span class="token punctuation">.</span>gradientType <span class="token operator">=</span> <span class="token punctuation">.</span>radial
symbolGradient<span class="token punctuation">.</span>startAnchor <span class="token operator">=</span> <span class="token class-name">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">0.25</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0.75</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> plotSymbol <span class="token operator">=</span> <span class="token class-name">CPTPlotSymbol</span><span class="token punctuation">.</span><span class="token function">ellipse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
plotSymbol<span class="token punctuation">.</span>fill <span class="token operator">=</span> <span class="token class-name">CPTFill</span><span class="token punctuation">(</span>gradient<span class="token punctuation">:</span> symbolGradient<span class="token punctuation">)</span>
plotSymbol<span class="token punctuation">.</span>lineStyle <span class="token operator">=</span> <span class="token nil constant">nil</span><span class="token punctuation">;</span>
plotSymbol<span class="token punctuation">.</span>size <span class="token operator">=</span> <span class="token class-name">CGSize</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token constant">kPlotSymbolSize</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token constant">kPlotSymbolSize</span><span class="token punctuation">)</span>
plot<span class="token punctuation">.</span>plotSymbol <span class="token operator">=</span> plotSymbol<span class="token punctuation">;</span>
plot<span class="token punctuation">.</span>plotSymbolMarginForHitDetection <span class="token operator">=</span> <span class="token class-name">CGFloat</span><span class="token punctuation">(</span><span class="token constant">kPlotSymbolSize</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token class-name">CGFloat</span><span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">)</span>
graph<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>plot<span class="token punctuation">,</span> to<span class="token punctuation">:</span> plotSpace<span class="token punctuation">)</span>
</code></pre><p>As before we define the line style, but we also define a symbol to show. Here, we use a gradient to color the circular symbol. We also set <code>plotSymbolMarginForHitDetection</code> with a larger size than the symbol size to make touching the symbol easier. Touching the symbol shows the actual sample value.</p><h2>Graph Legend</h2><p><img src=legend_960.png title=legend srcset="legend_480.png 480w,legend_650.png 650w,legend_960.png 960w,legend_1440.png 1440w" sizes="(min-width: 960px) 960px, calc(100vw-6rem)"></p><p>Core Plot will draw a legend that shows plot indicators (color line and/or symbols) and a name. Note that the order of the components in the legend are in the same order as how the plots were added to the graph. Here’s the setup code that configures the legend:</p><pre class=language-swift><code class=language-swift><span class="token keyword">let</span> legend <span class="token operator">=</span> <span class="token class-name">CPTLegend</span><span class="token punctuation">(</span>graph<span class="token punctuation">:</span> graph<span class="token punctuation">)</span>
graph<span class="token punctuation">.</span>legend <span class="token operator">=</span> legend
graph<span class="token punctuation">.</span>legendAnchor <span class="token operator">=</span> <span class="token punctuation">.</span>top
graph<span class="token punctuation">.</span>legendDisplacement <span class="token operator">=</span> <span class="token class-name">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">5.0</span><span class="token punctuation">)</span>
legend<span class="token punctuation">.</span>isHidden <span class="token operator">=</span> <span class="token boolean">true</span>
legend<span class="token punctuation">.</span>fill <span class="token operator">=</span> <span class="token class-name">CPTFill</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token class-name">CPTColor</span><span class="token punctuation">.</span><span class="token function">darkGray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withAlphaComponent</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> titleStyle <span class="token operator">=</span> <span class="token class-name">CPTMutableTextStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
titleStyle<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token class-name">CPTColor</span><span class="token punctuation">(</span>genericGray<span class="token punctuation">:</span> <span class="token number">0.75</span><span class="token punctuation">)</span>
titleStyle<span class="token punctuation">.</span>fontSize <span class="token operator">=</span> <span class="token number">11.0</span>
legend<span class="token punctuation">.</span>textStyle <span class="token operator">=</span> titleStyle<span class="token punctuation">;</span>
<span class="token keyword">let</span> lineStyle <span class="token operator">=</span> <span class="token class-name">CPTMutableLineStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
lineStyle<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">0.75</span>
lineStyle<span class="token punctuation">.</span>lineColor <span class="token operator">=</span> <span class="token class-name">CPTColor</span><span class="token punctuation">(</span>genericGray<span class="token punctuation">:</span> <span class="token number">0.45</span><span class="token punctuation">)</span>
legend<span class="token punctuation">.</span>borderLineStyle <span class="token operator">=</span> lineStyle
legend<span class="token punctuation">.</span>cornerRadius <span class="token operator">=</span> <span class="token number">5.0</span>
legend<span class="token punctuation">.</span>swatchSize <span class="token operator">=</span> <span class="token class-name">CGSize</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">25.0</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">25.0</span><span class="token punctuation">)</span>
legend<span class="token punctuation">.</span>numberOfRows <span class="token operator">=</span> <span class="token number">1</span>
legend<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span>
<span class="token keyword">let</span> recognizer <span class="token operator">=</span> <span class="token class-name">UITapGestureRecognizer</span><span class="token punctuation">(</span>target<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> <span class="token other-directive property">#selector</span><span class="token punctuation">(</span>handleTap<span class="token punctuation">)</span><span class="token punctuation">)</span>
recognizer<span class="token punctuation">.</span>numberOfTouchesRequired <span class="token operator">=</span> <span class="token number">1</span>
recognizer<span class="token punctuation">.</span>numberOfTapsRequired <span class="token operator">=</span> <span class="token number">2</span>
<span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">addGestureRecognizer</span><span class="token punctuation">(</span>recognizer<span class="token punctuation">)</span>
</code></pre><p>The legend will appear at the top of the graph, but it is initially hidden. A custom <code>UITabGestureRecognizer</code> will toggle legend visibility when the user taps twice on the graph. Setting the legend’s <code>delegate</code> property will allow us to toggle visibility of individual plots when a legend component is tapped. Here are the methods that control visibility, first for the legend as a whole, and then for individual plots:</p><pre class=language-swift><code class=language-swift><span class="token keyword">func</span> <span class="token function-definition function">handleTap</span><span class="token punctuation">(</span>recognizer<span class="token punctuation">:</span> <span class="token class-name">UITapGestureRecognizer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">guard</span> <span class="token keyword">let</span> legend <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>hostedGraph<span class="token operator">?</span><span class="token punctuation">.</span>legend <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
    legend<span class="token punctuation">.</span>isHidden <span class="token operator">=</span> <span class="token operator">!</span>legend<span class="token punctuation">.</span>isHidden
<span class="token punctuation">}</span>
</code></pre><pre class=language-swift><code class=language-swift><span class="token keyword">func</span> <span class="token function-definition function">legend</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> legend<span class="token punctuation">:</span> <span class="token class-name">CPTLegend</span><span class="token punctuation">,</span> legendEntryFor plot<span class="token punctuation">:</span> <span class="token class-name">CPTPlot</span><span class="token punctuation">,</span> wasSelectedAt idx<span class="token punctuation">:</span> <span class="token class-name">UInt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    plot<span class="token punctuation">.</span>isHidden <span class="token operator">=</span> <span class="token operator">!</span>plot<span class="token punctuation">.</span>isHidden
<span class="token punctuation">}</span>
</code></pre><h2>Auto-Scaling in Y</h2><p>When a new data sample arrives or when the user scrolls the graph in the X direction, I wanted the graph to update the Y axis to always have the max value in the view as the max value of the Y axis (plus some padding). To accomplish this, I first obtain the view values of the X axis in plot space units (seconds), and then query the data source for the min/max sample values that fall between the two times.</p><pre class=language-swift><code class=language-swift><span class="token keyword">fileprivate</span> <span class="token keyword">func</span> <span class="token function-definition function">updateYRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">guard</span> <span class="token keyword">let</span> plotSpace <span class="token operator">=</span> hostedGraph<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">allPlotSpaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>last <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">CPTXYPlotSpace</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
    <span class="token keyword">guard</span> <span class="token keyword">let</span> axisSet <span class="token operator">=</span> hostedGraph<span class="token operator">?</span><span class="token punctuation">.</span>axisSet <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">CPTXYAxisSet</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
    <span class="token keyword">guard</span> <span class="token keyword">let</span> x <span class="token operator">=</span> axisSet<span class="token punctuation">.</span>xAxis <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
    <span class="token keyword">guard</span> <span class="token keyword">let</span> y <span class="token operator">=</span> axisSet<span class="token punctuation">.</span>yAxis <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
    <span class="token keyword">let</span> xRange <span class="token operator">=</span> plotSpace<span class="token punctuation">.</span>xRange
    <span class="token keyword">let</span> yMinMax <span class="token operator">=</span> <span class="token function">findMinMaxInRange</span><span class="token punctuation">(</span>range<span class="token punctuation">:</span> xRange<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> yMax <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span>yMinMax<span class="token punctuation">.</span>max <span class="token operator">+</span> <span class="token number">0.9</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> targetYMax <span class="token operator">!=</span> yMax <span class="token punctuation">{</span>
        targetYMax <span class="token operator">=</span> yMax
        <span class="token keyword">let</span> yRange <span class="token operator">=</span> <span class="token class-name">CPTMutablePlotRange</span><span class="token punctuation">(</span>location<span class="token punctuation">:</span> <span class="token class-name">NSNumber</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> length<span class="token punctuation">:</span> <span class="token class-name">NSNumber</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> yMax<span class="token punctuation">)</span><span class="token punctuation">)</span>
        y<span class="token punctuation">.</span>majorTickLocations <span class="token operator">=</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token class-name">NSNumber</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> yMax <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> yMax<span class="token punctuation">]</span><span class="token punctuation">.</span>map <span class="token punctuation">{</span> <span class="token class-name">NSNumber</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token short-argument">$0</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        y<span class="token punctuation">.</span>visibleAxisRange <span class="token operator">=</span> yRange
        y<span class="token punctuation">.</span>visibleRange <span class="token operator">=</span> yRange
        x<span class="token punctuation">.</span>gridLinesRange <span class="token operator">=</span> yRange
        yRange<span class="token punctuation">.</span><span class="token function">expand</span><span class="token punctuation">(</span>byFactor<span class="token punctuation">:</span> <span class="token number">1.05</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> oldRange <span class="token operator">=</span> plotSpace<span class="token punctuation">.</span>yRange
        <span class="token class-name">CPTAnimation</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span>plotSpace<span class="token punctuation">,</span> property<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"yRange"</span></span><span class="token punctuation">,</span> from<span class="token punctuation">:</span> oldRange<span class="token punctuation">,</span> to<span class="token punctuation">:</span> yRange<span class="token punctuation">,</span> duration<span class="token punctuation">:</span> <span class="token number">0.25</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    y<span class="token punctuation">.</span>gridLinesRange <span class="token operator">=</span> xRange
<span class="token punctuation">}</span>
</code></pre><p>The <code>findMinMaxInRange</code> method will return the min/max Y values for the currently display X range. We then round up the max value to the nearest whole value, and if it is not the same as the last max value, we update the graph and Y axis so it will show the new Y range.</p><pre class=language-swift><code class=language-swift><span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">findFirstSampleAtOrBefore</span><span class="token punctuation">(</span>when<span class="token punctuation">:</span> <span class="token class-name">TimeInterval</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Int</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> pos <span class="token operator">=</span> source<span class="token punctuation">.</span>samples<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token short-argument">$0</span><span class="token punctuation">.</span>arrivalTime<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insertionIndexOf</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> source<span class="token punctuation">.</span>startTime<span class="token punctuation">.</span><span class="token function">addingTimeInterval</span><span class="token punctuation">(</span>when<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                    predicate<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token short-argument">$0</span> <span class="token operator">&lt;</span> <span class="token short-argument">$1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> pos
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">findMinMaxInRange</span><span class="token punctuation">(</span>range<span class="token punctuation">:</span> <span class="token class-name">CPTPlotRange</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">(</span>min<span class="token punctuation">:</span> <span class="token class-name">Double</span><span class="token punctuation">,</span> max<span class="token punctuation">:</span> <span class="token class-name">Double</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> source<span class="token punctuation">.</span>samples<span class="token punctuation">.</span>count <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token nil constant">nil</span> <span class="token punctuation">}</span>
    <span class="token keyword">let</span> x0 <span class="token operator">=</span> <span class="token function">findFirstSampleAtOrBefore</span><span class="token punctuation">(</span>when<span class="token punctuation">:</span> range<span class="token punctuation">.</span>locationDouble<span class="token punctuation">)</span>
    <span class="token keyword">let</span> x1 <span class="token operator">=</span> <span class="token function">findFirstSampleAtOrBefore</span><span class="token punctuation">(</span>when<span class="token punctuation">:</span> range<span class="token punctuation">.</span>endDouble<span class="token punctuation">)</span>
    <span class="token keyword">return</span> source<span class="token punctuation">.</span>samples<span class="token punctuation">[</span>x0<span class="token operator">..&lt;</span>x1<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token short-argument">$0</span><span class="token punctuation">.</span>latency<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">minMax</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>The <code>findMinMaxInRange</code> functionality relies on two extensions to <code>Collection</code> types with <code>Comparable</code> elements. First, is the method <code>insertionIndexOf(value:,predicate:)</code> which will return the index in a collection where inserting a given value would keep the collection in an ordered state (see <a href=../swiftCollection/ >Adding Binary Search to Swift Collections</a> for specifics). This is used by the <code>findFirstSampleAtOrBefore(when:)</code> method. The second extension to <code>Collection</code> is a <code>minMax</code> method that returns a 2-tuple containing both the min and max values within a collection or a slice of one.</p><p>To auto-scale during scrolling, I implemented the <code>plotSpace(space:,didChangePlotRangeFor:)</code> method of the <code>CPTPlotpaceDelegate</code> protocol. Here, I discard any changes that make the X or Y axis min deviate from 0.0, and when the X axis changes, I call <code>updateYRange()</code>.</p><pre class=language-swift><code class=language-swift><span class="token keyword">extension</span> <span class="token class-name">GraphLatencyByTime</span><span class="token punctuation">:</span> <span class="token class-name">CPTPlotSpaceDelegate</span> <span class="token punctuation">{</span>
    <span class="token keyword">func</span> <span class="token function-definition function">plotSpace</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> space<span class="token punctuation">:</span> <span class="token class-name">CPTPlotSpace</span><span class="token punctuation">,</span> didChangePlotRangeFor coordinate<span class="token punctuation">:</span> <span class="token class-name">CPTCoordinate</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">guard</span> <span class="token keyword">let</span> plotSpace <span class="token operator">=</span> space <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">CPTXYPlotSpace</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
        <span class="token keyword">switch</span> coordinate <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token class-name">Y</span><span class="token punctuation">:</span>
            <span class="token keyword">let</span> yRange <span class="token operator">=</span> plotSpace<span class="token punctuation">.</span>yRange
            <span class="token keyword">if</span> yRange<span class="token punctuation">.</span>locationDouble <span class="token operator">!=</span> <span class="token number">0.0</span> <span class="token punctuation">{</span>
                plotSpace<span class="token punctuation">.</span>yRange <span class="token operator">=</span> <span class="token class-name">CPTPlotRange</span><span class="token punctuation">(</span>location<span class="token punctuation">:</span> <span class="token class-name">NSNumber</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> length<span class="token punctuation">:</span> yRange<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token class-name">X</span><span class="token punctuation">:</span>
            <span class="token keyword">let</span> xRange <span class="token operator">=</span> plotSpace<span class="token punctuation">.</span>xRange
            <span class="token keyword">if</span> xRange<span class="token punctuation">.</span>locationDouble <span class="token operator">&lt;</span> <span class="token number">0.0</span> <span class="token punctuation">{</span>
                plotSpace<span class="token punctuation">.</span>xRange <span class="token operator">=</span> <span class="token class-name">CPTPlotRange</span><span class="token punctuation">(</span>location<span class="token punctuation">:</span> <span class="token class-name">NSNumber</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> length<span class="token punctuation">:</span> xRange<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token function">updateYRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token keyword">break</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h2>Auto-Scrolling X</h2><p>If the user has not manually scrolled the graph to some point in the past, I want the graph to always show new samples when they arrive. Arrival of new samples cause an iOS Notification event which the graph listens for. It is processed in the <code>sampleAdded(notification:)</code> routine:</p><pre class=language-swift><code class=language-swift><span class="token keyword">func</span> <span class="token function-definition function">sampleAdded</span><span class="token punctuation">(</span>notification<span class="token punctuation">:</span> <span class="token class-name">Notification</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> info <span class="token operator">=</span> <span class="token class-name">RunDataNewSampleNotification</span><span class="token punctuation">(</span>notification<span class="token punctuation">:</span> notification<span class="token punctuation">)</span>
    <span class="token keyword">guard</span> <span class="token keyword">let</span> plots <span class="token operator">=</span> hostedGraph<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">allPlots</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
    plots<span class="token punctuation">.</span>forEach <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token short-argument">$0</span><span class="token punctuation">.</span>identifier <span class="token operator">===</span> <span class="token class-name">GraphLatencyByTime</span><span class="token punctuation">.</span><span class="token constant">kMissingPlotId</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> info<span class="token punctuation">.</span>sample<span class="token punctuation">.</span>missingCount <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> numRecords <span class="token operator">=</span> info<span class="token punctuation">.</span>sample<span class="token punctuation">.</span>missingCount <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span>
                <span class="token short-argument">$0</span><span class="token punctuation">.</span><span class="token function">insertData</span><span class="token punctuation">(</span>at<span class="token punctuation">:</span> <span class="token class-name">UInt</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span>missing<span class="token punctuation">.</span>count <span class="token operator">-</span> numRecords<span class="token punctuation">)</span><span class="token punctuation">,</span> numberOfRecords<span class="token punctuation">:</span> <span class="token class-name">UInt</span><span class="token punctuation">(</span>numRecords<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token short-argument">$0</span><span class="token punctuation">.</span><span class="token function">insertData</span><span class="token punctuation">(</span>at<span class="token punctuation">:</span> <span class="token class-name">UInt</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span> numberOfRecords<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span>isMainThread <span class="token punctuation">{</span>
        <span class="token function">updateBounds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token keyword">async</span><span class="token punctuation">(</span>execute<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>updateBounds<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre><p>First, each plot’s <code>insertData</code> method is called with the number of new records to add to the plot. the “missing samples” plot adds 2N + 1 records for N missing samples, since the plot shows a very tall rectangle for each missing sample. Next, I update the plot bounds (both X and Y) with a call to <code>updateBounds</code>. Since the notification may arrive in a thread other than the main UI one, we make sure that <code>updateBounds</code> runs only on the main UI thread.</p><p>The scrolling takes place in the following snippet from <code>updateBounds</code>:</p><pre class=language-swift><code class=language-swift><span class="token keyword">else</span> <span class="token keyword">if</span> plotData<span class="token punctuation">.</span>count <span class="token operator">></span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token function">xValueFor</span><span class="token punctuation">(</span>sample<span class="token punctuation">:</span>plotData<span class="token punctuation">[</span>plotData<span class="token punctuation">.</span>count <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> plotSpace<span class="token punctuation">.</span>xRange<span class="token punctuation">.</span>endDouble <span class="token punctuation">{</span>
    <span class="token keyword">let</span> oldRange <span class="token operator">=</span> plotSpace<span class="token punctuation">.</span>xRange
    <span class="token keyword">let</span> newRange <span class="token operator">=</span> <span class="token class-name">CPTMutablePlotRange</span><span class="token punctuation">(</span>location<span class="token punctuation">:</span> <span class="token class-name">NSNumber</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> xMin<span class="token punctuation">)</span><span class="token punctuation">,</span> length<span class="token punctuation">:</span> <span class="token class-name">NSNumber</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> xMax <span class="token operator">-</span> xMin<span class="token punctuation">)</span><span class="token punctuation">)</span>
    newRange<span class="token punctuation">.</span><span class="token function">expand</span><span class="token punctuation">(</span>byFactor<span class="token punctuation">:</span> <span class="token number">1.05</span><span class="token punctuation">)</span>
    <span class="token class-name">CPTAnimation</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span>plotSpace<span class="token punctuation">,</span> property<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"xRange"</span></span><span class="token punctuation">,</span> from<span class="token punctuation">:</span> oldRange<span class="token punctuation">,</span> to<span class="token punctuation">:</span> newRange<span class="token punctuation">,</span> duration<span class="token punctuation">:</span> <span class="token number">0.25</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>Here we look to see if the the previous point is visible, and if so, we adjust the X range to show the new point, animating the transition from the old X range to the new one.</p><p><img src=autoScroll.gif alt=autoscrolling></p></section><footer class=post-footer><figure class=author-image><a class=img href=https://keystrokecountdown.com style=background-image:url(/images/HarrisonsLaugh.png)><span class=hidden>Brad Howes's Picture</span></a></figure><section class=author><h4><a href=https://keystrokecountdown.com>Brad Howes</a></h4><p>Owner <a href=https://apps.apple.com/us/developer/b-ray-software/id430573224>B-Ray Software</a>. Programmer in C++, Swift, Python, Javascript and more. Started out doing punch cards in FORTRAN.</p><div class=author-meta><span class="author-location icon-location">Paris, France</span> <span class="author-link icon-link"><a href=http://linkedin.com/in/bradhowes>http://linkedin.com/in/bradhowes</a></span> <span class="author-link icon-feed"><a href=mailto:bradhowes@mac.com>&nbsp;Email Me</a></span></div></section><section class=share><h4>Share this page</h4><div class=social-icons><a class=icon-twitter href="https://twitter.com/intent/tweet?text=Working%20with%20Core%20Plot&amp;url=https%3A%2Fkeystrokecountdown.com%2Farticles%2FcorePlot%2Findex.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;"><span class=hidden>Twitter</span> </a><a class=icon-feed href="mailto:bradhowes@mac.com?subject=Curiosity&body=https%3A%2Fkeystrokecountdown.com%2Farticles%2FcorePlot%2Findex.html"><span class=hidden>Email</span></a></div></section></footer></article></main><aside class=read-next><a class=read-next-story style="background-image: url(/articles/slidingViews/animation.gif)" href=/articles/slidingViews/index.html><section class=post><h2>Sliding UIViews with Core Animation</h2><div class=post-meta>Shows how to easily animate sliding UIViews for a nice visual effect</div></section></a><a class="read-next-story prev" style="background-image: url(/articles/dependencyInjection/dependency-injection.png)" href=/articles/dependencyInjection/index.html><section class=post><h2>Dependency Injection for iOS in Swift</h2><div class=post-meta>Documents how I implemented dependency injection in a Swift iOS project</div></section></a></aside><footer class="site-footer clearfix"><section class=copyright><a href=https://keystrokecountdown.com>Keystroke Countdown</a> &copy; <span id=copyrightYear>2016</span> Brad Howes — <a href=https://github.com/bradhowes/keystrokecountdown>Source</a></section></footer></div><script>(function () {
      var installClickHandlers = function () {
        var navElement = document.getElementById("nav");
    
        // The click handler just toggles classes to do the showing/hiding
        //
        var clickHandler = function(e) {
          document.body.classList.toggle("nav-opened");
          document.body.classList.toggle("nav-closed");
          if (navElement) {
            navElement.classList.toggle("nav-opened");
            navElement.classList.toggle("nav-closed");
          }
        };
    
        // Find elements we wish to tap for click events
        //
        var elements = Array.prototype.slice.call(
          document.querySelectorAll(".menu-button, .nav-cover, .nav-close"));
        if (elements && elements.length > 0) {
          elements.forEach(function (element) {
            element.addEventListener('click', clickHandler);
          });
        }
      };
    
      // When the document is finished loading, install event handlers to show/hide sidebar menu
      //
      window.document.addEventListener("DOMContentLoaded", function (event) {
        installClickHandlers();
    
        // Set the copyright year at the bottom of our pages
        //
        window.document.getElementById("copyrightYear").innerHTML = (new Date()).getFullYear();
      });
    })();</script></body></html>