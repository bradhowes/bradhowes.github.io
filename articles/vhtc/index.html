<!DOCTYPE html><html lang=en-US><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Variable Height UITableView Cells in Swift | Keystroke Countdown</title><meta name=author content="[object Object]"><meta name=robots content="index, follow"><meta name=HandheldFriendly content=True><meta name=description content="Documents code necessary to achieve fast variable-height cells that use Auto Layout"><link rel=author href=/humans.txt><link rel=icon type=image/png href=/images/favicon.png><link rel=stylesheet href=/css/all-219136742a6fdee2bdc61d07f9ed89cc.css></head><body class="post-template nav-closed"><div class="nav nav-closed" id=nav><h3 class=nav-title>Menu</h3><a href=# class=nav-close><span class=hidden>Close</span></a><ul class=nav-list><li class=nav-home role=presentation><a href=/ ><i class="fa fa-home" aria-hidden=true></i> Home</a></li><li class=nav-home role=presentation><a href=/about><i class="fa fa-info-circle" aria-hidden=true></i> About Me</a></li><li class=nav-nome role=presentation><a href=/rss.xml><i class="fa fa-rss" aria-hidden=true></i> Subscribe</a> <a href="https://validator.w3.org/feed/check.cgi?url=https%3A//keystrokecountdown.com/rss.xml"><img src=/images/valid-rss-rogers.png alt="[Valid RSS]" title="Validate my RSS feed"></a></li><li class=nav-home role=presentation><a href=/topics><i class="fa fa-tags" aria-hidden=true></i> Topics</a></li><br><li class=nav-home role=presentation><a href=/articles/auv3/index.html>AUv3 Development -- Part 1 of N</a></li><li class=nav-home role=presentation><a href=/articles/knobci/index.html>Swift Snapshot Testing in Github Actions</a></li><li class=nav-home role=presentation><a href=/articles/wma/index.html>Converting WMA Files to MP3</a></li><li class=nav-home role=presentation><a href=/articles/remarkable/index.html>Remarkable Customizations</a></li><li class=nav-home role=presentation><a href=/articles/browsers/index.html>Automatic Browser Selection</a></li><li class=nav-home role=presentation><a href=/articles/genart/index.html>Generative Images with SVG.js</a></li><li class=nav-home role=presentation><a href=/articles/logistic/index.html>Simple Image Classification using Logistic Regression</a></li><li class=nav-home role=presentation><a href=/articles/kerberos/index.html>Using Kerboros on macOS</a></li><li class=nav-home role=presentation><a href=/articles/translate/index.html>Text Language Translation Utility</a></li><li class=nav-home role=presentation><a href=/articles/keymaps/index.html>Remapping Keys on macOS High Sierra</a></li><li class=nav-home role=presentation><a href=/articles/letencrypt/index.html>Fixing Azure Let&#x27;s Encrypt Expired Key</a></li><li class=nav-home role=presentation><a href=/articles/console/index.html>Formatting Console Output</a></li><li class=nav-home role=presentation><a href=/articles/layout/index.html>[DRAFT] Test Page for CSS Settings</a></li><li class=nav-home role=presentation><a href=/articles/docker/index.html>[DRAFT] Playing with .Net Core Apps and Docker on a Mac</a></li><li class=nav-home role=presentation><a href=/articles/autohotkey/index.html>Different (Key)strokes for Different Folks</a></li><li class=nav-home role=presentation><a href=/articles/itunes/index.html>Apple iTunes Library Manipulation with Python</a></li><li class=nav-home role=presentation><a href=/articles/metalsmith2/index.html>Metalsmith Plugins for Server-side KaTeX Processing</a></li><li class=nav-home role=presentation><a href=/articles/poisson/index.html>Arrival Intervals of a Poisson Process</a></li><li class=nav-home role=presentation><a href=/articles/cocoapods/index.html>Framework Bundles in Xcode and CocoaPods</a></li><li class=nav-home role=presentation><a href=/articles/signing/index.html>Signing Embedded Frameworks in an Embedded Framework</a></li><li class=nav-home role=presentation><a href=/articles/vhtc/index.html>Variable Height UITableView Cells in Swift</a></li><li class=nav-home role=presentation><a href=/articles/joystick/index.html>JoyStickView for iOS in Swift</a></li><li class=nav-home role=presentation><a href=/articles/dependencyInjection/index.html>Dependency Injection for iOS in Swift</a></li><li class=nav-home role=presentation><a href=/articles/corePlot/index.html>Working with Core Plot</a></li><li class=nav-home role=presentation><a href=/articles/slidingViews/index.html>Sliding UIViews with Core Animation</a></li><li class=nav-home role=presentation><a href=/articles/swiftCollection/index.html>Adding Binary Search to Swift Collections</a></li><li class=nav-home role=presentation><a href=/articles/metalsmith/index.html>Metalsmith Static Site on Azure</a></li><li class=nav-home role=presentation><a href=/articles/bloom/index.html>Bloom Filters in Python</a></li><li class=nav-home role=presentation><a href="/articles/Testing IPython/testing-ipython.html">Testing IPython</a></li><li class=nav-home role=presentation><a href=/articles/decrypt/index.html>Decrypting Logs in Python</a></li><li class=nav-home role=presentation><a href=/articles/power/index.html>Power of Optimal Algorithm Design</a></li><li class=nav-home role=presentation><a href=/articles/PDMPlayground/index.html>PDM Playground</a></li><li class=nav-home role=presentation><a href=/articles/bscope/index.html>B-Scope Radar Display</a></li><li class=nav-home role=presentation><a href=/articles/ascope/index.html>A-Scope Signal Display</a></li><li class=nav-home role=presentation><a href=/articles/radardisplay/index.html>Radar Display</a></li><li class=nav-home role=presentation><a href=/articles/dfwtraffic/index.html>Visualizing Traffic at DFW Airport</a></li></ul></div><span class=nav-cover></span><div class=site-wrapper><header class="main-header post-head" style="background-image: url(/articles/vhtc/animation.gif)"><nav class="main-nav overlay clearfix"><a class="menu-button icon-menu" href=#><span class=word>Menu</span></a></nav></header><main class=content role=main><article class=post><header class=post-header><h1 class=post-title><a href=/ >Variable Height UITableView Cells in Swift</a></h1><section class=post-meta><time class=post-date datetime="Sat Jan 07 2017 12:18:02 GMT+0100 (Central European Standard Time)">Jan 7th, 2017</time> <a class=post-date href=/topics><i class="fa fa-tags" aria-hidden=true></i></a> <a class=post-date href=/topics/swift.html>Swift (10)</a> • <a class=post-date href=/topics/ui.html>UI (5)</a></section></header><section class=post-content><p>Recently, I have been working on a chat view in Swift for a project that uses a <a href=http://mattermost.org>Mattermost</a> for a back-end. Each entry in the chat view contains a <a href=https://developer.apple.com/reference/uikit/uitextview><code>UITextView</code></a> which is probably overkill but I wanted to use its built-in data detection features and link presentations. I designed up a cell in Xcode that looked something like this.</p><p><img src=IncomingCell_960.png title="" srcset="IncomingCell_480.png 480w,IncomingCell_650.png 650w,IncomingCell_960.png 960w,IncomingCell_1440.png 1440w" sizes="(min-width: 960px) 960px, calc(100vw-6rem)"></p><p>The central view filled with nonsense words of Latin is a <code>UITextView</code>. My desire was to make the width of this view vary in size depending on the content.</p><p>Normally, a <code>UITextView</code> offers a scrollbar when it contains content that is larger than the view’s frame. I definitely did not want this behavior, so the first step was to disable the scrollbar for the <code>UITextView</code>.</p><p><img src=DisableScrolling_960.png title="" srcset="DisableScrolling_480.png 480w,DisableScrolling_650.png 650w,DisableScrolling_960.png 960w,DisableScrolling_1440.png 1440w" sizes="(min-width: 960px) 960px, calc(100vw-6rem)"></p><p>Trying this out, I did indeed not have a scrollable view, but I also did not have a view that grew to show its entire content. I next went to Google to find a variety of opinions on how to make this work, but nothing I did seemed to work. Rather, I spent an embarrassing amount of time playing with Auto Layout settings and constraints with little or no success. I would see something promising only to hit a road-block.</p><p>Finally, I decided to punt and rely on a feature of <code>UITableView</code> that allowed one to offer an <em>estimate</em> of cell height. This indeed seemed to work, but at times there was a race between the gradual adjustment of the scroll view with real cell heights and changes in the frame of the <code>UITableView</code> – for instance, when a keyboard appears – which made for a sub-optimal experience.</p><h2>Take Two</h2><p>After solving other issues with the chat view, I decided to try once again to solve the variable height issue. Starting from a new, clean project, I methodically began to create a set of classes that might solve the problem. First, I went back to Apple’s documentation for <code>UITextView</code> and its ancestor <code>UIView</code>, and I was reminded of the concept of <em>intrinsic size</em>, a property some view’s can adopt when they have some knowledge about what they are displaying. Since a <code>UITextView</code> is adapted from <code>UIScrollView</code> it does not really have such a size property — it instead relies on its ability to show content in a scrollable view, the size of which is set by other means, such as by Auto Layout constraints. However, there is nothing to prevent the <code>UITextView</code> to adopt an <em>intrinsic size</em> using its text content and an available width, say something derived from the fixed width of the table in which the cell resides.</p><p>I create a new derivation of <code>UITextView</code> called <code>FullTextView</code>, and there I managed the read-only property <code>intrinsicContentSize</code> by providing my own, calculated size called <code>fittedSize</code>.</p><pre class=language-swift><code class=language-swift><span class="token comment">/// Holds any calculated fitted size (see updateFittedSize() below).</span>
<span class="token keyword">var</span> fittedSize<span class="token punctuation">:</span> <span class="token class-name">CGSize</span><span class="token operator">?</span> <span class="token operator">=</span> <span class="token nil constant">nil</span>

<span class="token comment">/// Override intrinsicContentSize to return calculated fittedSize if it exists</span>
<span class="token keyword">override</span> <span class="token keyword">public</span> <span class="token keyword">var</span> intrinsicContentSize<span class="token punctuation">:</span> <span class="token class-name">CGSize</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span>fittedSize <span class="token operator">??</span> <span class="token keyword">super</span><span class="token punctuation">.</span>intrinsicContentSize
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>To calculate <code>fittedSize</code> I use the <code>UITextView</code>'s own <a href=https://developer.apple.com/reference/uikit/nslayoutmanager><code>NSLayoutManager</code></a> to generate one for me.</p><pre class=language-swift><code class=language-swift><span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">updateFittedSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Key!</span>
    <span class="token comment">//</span>
    <span class="token keyword">let</span> usedRect <span class="token operator">=</span> layoutManager<span class="token punctuation">.</span><span class="token function">usedRect</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> textContainer<span class="token punctuation">)</span>
    fittedSize <span class="token operator">=</span> <span class="token class-name">CGSize</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token punctuation">(</span>usedRect<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width <span class="token operator">+</span> textContainerInset<span class="token punctuation">.</span><span class="token keyword">left</span> <span class="token operator">+</span> textContainerInset<span class="token punctuation">.</span><span class="token keyword">right</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        height<span class="token punctuation">:</span> <span class="token punctuation">(</span>usedRect<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height <span class="token operator">+</span> textContainerInset<span class="token punctuation">.</span>top <span class="token operator">+</span> textContainerInset<span class="token punctuation">.</span>bottom<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">invalidateIntrinsicContentSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>From my initial tests, the value returned from <code>updateFittedSize</code> matched those from properly laid out <code>UITextView</code> views. Cool!</p><p>For content updates, I hooked into two <code>UITextView</code> properties to know when they changed so that I would know when <code>fittedSize</code> needed an updated value.</p><pre class=language-swift><code class=language-swift><span class="token keyword">override</span> <span class="token keyword">public</span> <span class="token keyword">var</span> attributedText<span class="token punctuation">:</span> <span class="token class-name">NSAttributedString</span><span class="token operator">!</span> <span class="token punctuation">{</span>
    <span class="token keyword">didSet</span> <span class="token punctuation">{</span>
        <span class="token function">updateFittedSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">override</span> <span class="token keyword">public</span> <span class="token keyword">var</span> text<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token operator">!</span> <span class="token punctuation">{</span>
    <span class="token keyword">didSet</span> <span class="token punctuation">{</span>
        <span class="token function">updateFittedSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Next, I needed a <code>UITableViewCell</code> that would properly size itself when a <code>UITextView</code> it held had a new size or when the table the cell belonged to changed width – say due to an device orientation change. Here, the key was to trigger the proper layout calculations so that when finally displayed in the table, the view would be correct. There are two times where these calculations need to be accurately performed:</p><ol><li>When the width of the cell changes</li><li>When one or more of the views that make up the cell change</li></ol><p>At these times, we must ask the cell to redo the layout so that the presentation and height values will be correct. To do that we must call <code>layoutIfNeeded</code> to trigger a new layout.</p><pre class=language-swift><code class=language-swift><span class="token keyword">public</span> <span class="token keyword">func</span> <span class="token function-definition function">setup</span><span class="token punctuation">(</span>content<span class="token punctuation">:</span> <span class="token class-name">Content</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Cell</span> <span class="token punctuation">{</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>heading<span class="token punctuation">.</span>text <span class="token operator">=</span> content<span class="token punctuation">.</span>title
    <span class="token keyword">self</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>text <span class="token operator">=</span> content<span class="token punctuation">.</span>text
    <span class="token keyword">self</span><span class="token punctuation">.</span>avatar<span class="token punctuation">.</span>image <span class="token operator">=</span> content<span class="token punctuation">.</span>image
    contentView<span class="token punctuation">.</span><span class="token function">layoutIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">self</span>
<span class="token punctuation">}</span>

<span class="token comment">/// Calculate and return the height of this cell using whatever content is currently in the views.</span>
<span class="token keyword">public</span> <span class="token keyword">var</span> cellHeightForContent<span class="token punctuation">:</span> <span class="token class-name">CGFloat</span> <span class="token punctuation">{</span>
    contentView<span class="token punctuation">.</span><span class="token function">layoutIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> contentView<span class="token punctuation">.</span><span class="token function">systemLayoutSizeFitting</span><span class="token punctuation">(</span><span class="token class-name">UILayoutFittingCompressedSize</span><span class="token punctuation">)</span><span class="token punctuation">.</span>height
<span class="token punctuation">}</span>

<span class="token comment">/// The current cell width. Adjust to recalculate cell heights.</span>
<span class="token keyword">public</span> <span class="token keyword">var</span> cellWidth<span class="token punctuation">:</span> <span class="token class-name">CGFloat</span> <span class="token operator">=</span> <span class="token number">0.0</span> <span class="token punctuation">{</span>
    <span class="token keyword">didSet</span> <span class="token punctuation">{</span>
        contentView<span class="token punctuation">.</span>frame <span class="token operator">=</span> <span class="token class-name">CGRect</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> width<span class="token punctuation">:</span> cellWidth<span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">9999.0</span><span class="token punctuation">)</span>
        contentView<span class="token punctuation">.</span><span class="token function">layoutIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h2>Height Calculation Strategies</h2><p>My original searching for a solution revealed several ways to convey height information to a <code>UITableView</code>, both exact and estimated. I decided to try and encapsulate height calculation in such a way that I could just switch between different calculating strategies to see which one would be more performant. Thus a Swift protocol was born.</p><pre class=language-swift><code class=language-swift><span class="token keyword">public</span> <span class="token keyword">protocol</span> <span class="token class-name">HeightCalculationStrategy</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> cellWidth<span class="token punctuation">:</span> <span class="token class-name">CGFloat</span> <span class="token punctuation">{</span><span class="token keyword">get</span> <span class="token keyword">set</span><span class="token punctuation">}</span>

    <span class="token comment">/**
     Obtain the height of a cell when it holds a given sent of content
     - parameter content: data to put into the cell
     - parameter indexPath: the index of the cell being measured
     - returns: calculated height of the cell as it would appear in the table
     */</span>
    <span class="token keyword">func</span> <span class="token function-definition function">getHeight</span><span class="token punctuation">(</span><span class="token keyword">for</span> content<span class="token punctuation">:</span> <span class="token class-name">Content</span><span class="token punctuation">,</span> at indexPath<span class="token punctuation">:</span> <span class="token class-name">IndexPath</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">CGFloat</span>
<span class="token punctuation">}</span>
</code></pre><p>I then created two strategies, one that would keep a height cache and only ever return correct values, and another that would again set the <code>estimatedHeight</code> attribute for a <code>UITableView</code> but also provide accurate height information when asked.</p><p>Both approaches relied on a privately-held instance of the <code>Cell</code> class I created from <code>UITableViewCell</code> (described above). A common base class fetches one for us like so:</p><pre class=language-swift><code class=language-swift><span class="token keyword">self</span><span class="token punctuation">.</span>sizer <span class="token operator">=</span> <span class="token class-name">UINib</span><span class="token punctuation">(</span>nibName<span class="token punctuation">:</span> cellIdent<span class="token punctuation">,</span> bundle<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">instantiate</span><span class="token punctuation">(</span>withOwner<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">,</span> options<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">as</span><span class="token operator">!</span> <span class="token class-name">Cell</span>
</code></pre><p>For the cached height strategy, I simply calculated all necessary heights in one shot like so:</p><pre class=language-swift><code class=language-swift><span class="token keyword">if</span> heights<span class="token punctuation">.</span>count <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
    heights <span class="token operator">=</span> dataSource<span class="token punctuation">.</span>map <span class="token punctuation">{</span> <span class="token punctuation">(</span>sizer<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span>content<span class="token punctuation">:</span> <span class="token short-argument">$0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cellHeightForContent <span class="token operator">+</span> verticalSpacing<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rounded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> heights<span class="token punctuation">[</span>indexPath<span class="token punctuation">.</span>row<span class="token punctuation">]</span>
</code></pre><p>The <code>EstimatedHeightCalculationStrategy</code> did the same, only for just one cell at a time:</p><pre class=language-swift><code class=language-swift><span class="token keyword">return</span> <span class="token punctuation">(</span>sizer<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span>content<span class="token punctuation">:</span> content<span class="token punctuation">)</span><span class="token punctuation">.</span>cellHeightForContent <span class="token operator">+</span> verticalSpacing<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rounded</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><blockquote><p>Note that the requirement for <code>content</code> is a major sore spot in this protocol design since only one of the strategies uses it.</p></blockquote><h2>Putting it Together</h2><p>A final class, <code>VariableHeightTableController</code> brings everything together in marvelous fashion. It its <code>viewDidLoad</code> method, we give the table a source of data to use for cell content, and we establish that the <code>Cell</code> class will visually represent the rows of the table. Finally, we create and install a height calculation strategy.</p><pre class=language-swift><code class=language-swift><span class="token keyword">self</span><span class="token punctuation">.</span>cellIdent <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Cell"</span></span>
<span class="token keyword">self</span><span class="token punctuation">.</span>dataSource <span class="token operator">=</span> <span class="token class-name">DataSource</span><span class="token punctuation">(</span>cellIdent<span class="token punctuation">:</span> cellIdent<span class="token punctuation">,</span> count<span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">)</span>
tableView<span class="token punctuation">.</span>dataSource <span class="token operator">=</span> dataSource
tableView<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">UINib</span><span class="token punctuation">(</span>nibName<span class="token punctuation">:</span> cellIdent<span class="token punctuation">,</span> bundle<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span><span class="token punctuation">,</span> forCellReuseIdentifier<span class="token punctuation">:</span> cellIdent<span class="token punctuation">)</span>
heightCalculationStrategy <span class="token operator">=</span> <span class="token function">makeStrategy</span><span class="token punctuation">(</span>useFast<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre><p>When the view appears or when the view’s size changes, we must convey the size change to our height calculation strategy instance so that future calls to its <code>getHeight</code> will return correct values:</p><pre class=language-swift><code class=language-swift><span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function-definition function">viewWillAppear</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> animated<span class="token punctuation">:</span> <span class="token class-name">Bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    heightCalculationStrategy<span class="token punctuation">.</span>cellWidth <span class="token operator">=</span> view<span class="token punctuation">.</span>frame<span class="token punctuation">.</span>width
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">viewWillAppear</span><span class="token punctuation">(</span>animated<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function-definition function">viewWillTransition</span><span class="token punctuation">(</span>to size<span class="token punctuation">:</span> <span class="token class-name">CGSize</span><span class="token punctuation">,</span> with coordinator<span class="token punctuation">:</span> <span class="token class-name">UIViewControllerTransitionCoordinator</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">viewWillTransition</span><span class="token punctuation">(</span>to<span class="token punctuation">:</span> size<span class="token punctuation">,</span> with<span class="token punctuation">:</span> coordinator<span class="token punctuation">)</span>
    coordinator<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span>alongsideTransition<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>heightCalculationStrategy<span class="token punctuation">.</span>cellWidth <span class="token operator">=</span> size<span class="token punctuation">.</span>width
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Finally, we convey calculated height information to the table view:</p><pre class=language-swift><code class=language-swift><span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function-definition function">tableView</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> tableView<span class="token punctuation">:</span> <span class="token class-name">UITableView</span><span class="token punctuation">,</span> heightForRowAt indexPath<span class="token punctuation">:</span> <span class="token class-name">IndexPath</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">CGFloat</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> heightCalculationStrategy<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>dataSource<span class="token punctuation">[</span>indexPath<span class="token punctuation">.</span>row<span class="token punctuation">]</span><span class="token punctuation">,</span> at<span class="token punctuation">:</span> indexPath<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><h2>Result</h2><p><img src=animation.gif alt=""></p><h2>Source</h2><p>The source is <a href=https://github.com/bradhowes/vhtc>freely available on Github</a>.</p></section><footer class=post-footer><figure class=author-image><a class=img href=https://keystrokecountdown.com style=background-image:url(/images/HarrisonsLaugh.png)><span class=hidden>Brad Howes's Picture</span></a></figure><section class=author><h4><a href=https://keystrokecountdown.com>Brad Howes</a></h4><p>Owner <a href=https://apps.apple.com/us/developer/b-ray-software/id430573224>B-Ray Software</a>. Programmer in C++, Swift, Python, Javascript and more. Started out doing punch cards in FORTRAN.</p><div class=author-meta><span class="author-location icon-location">Paris, France</span> <span class="author-link icon-link"><a href=http://linkedin.com/in/bradhowes>http://linkedin.com/in/bradhowes</a></span> <span class="author-link icon-feed"><a href=mailto:bradhowes@mac.com>&nbsp;Email Me</a></span></div></section><section class=share><h4>Share this page</h4><div class=social-icons><a class=icon-twitter href="https://twitter.com/intent/tweet?text=Variable%20Height%20UITableView%20Cells%20in%20Swift&amp;url=https%3A%2Fkeystrokecountdown.com%2Farticles%2Fvhtc%2Findex.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;"><span class=hidden>Twitter</span> </a><a class=icon-feed href="mailto:bradhowes@mac.com?subject=Curiosity&body=https%3A%2Fkeystrokecountdown.com%2Farticles%2Fvhtc%2Findex.html"><span class=hidden>Email</span></a></div></section></footer></article></main><aside class=read-next><a class=read-next-story style="background-image: url(/articles/joystick/animation.gif)" href=/articles/joystick/index.html><section class=post><h2>JoyStickView for iOS in Swift</h2><div class=post-meta>Documents how I implemented a joy stick control view for a Swift iOS project</div></section></a><a class="read-next-story prev" style="background-image: url(/articles/signing/image.png)" href=/articles/signing/index.html><section class=post><h2>Signing Embedded Frameworks in an Embedded Framework</h2><div class=post-meta>Short discussion about an issue I had using an embedded framework that itself contained embedded frameworks</div></section></a></aside><footer class="site-footer clearfix"><section class=copyright><a href=https://keystrokecountdown.com>Keystroke Countdown</a> &copy; <span id=copyrightYear>2017</span> Brad Howes — <a href=https://github.com/bradhowes/keystrokecountdown>Source</a></section></footer></div><script>(function () {
      var installClickHandlers = function () {
        var navElement = document.getElementById("nav");
    
        // The click handler just toggles classes to do the showing/hiding
        //
        var clickHandler = function(e) {
          document.body.classList.toggle("nav-opened");
          document.body.classList.toggle("nav-closed");
          if (navElement) {
            navElement.classList.toggle("nav-opened");
            navElement.classList.toggle("nav-closed");
          }
        };
    
        // Find elements we wish to tap for click events
        //
        var elements = Array.prototype.slice.call(
          document.querySelectorAll(".menu-button, .nav-cover, .nav-close"));
        if (elements && elements.length > 0) {
          elements.forEach(function (element) {
            element.addEventListener('click', clickHandler);
          });
        }
      };
    
      // When the document is finished loading, install event handlers to show/hide sidebar menu
      //
      window.document.addEventListener("DOMContentLoaded", function (event) {
        installClickHandlers();
    
        // Set the copyright year at the bottom of our pages
        //
        window.document.getElementById("copyrightYear").innerHTML = (new Date()).getFullYear();
      });
    })();</script></body></html>