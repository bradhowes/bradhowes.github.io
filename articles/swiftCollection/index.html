<!DOCTYPE html><html lang=en-US><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Adding Binary Search to Swift Collections | Keystroke Countdown</title><meta name=author content="[object Object]"><meta name=robots content="index, follow"><meta name=HandheldFriendly content=True><meta name=description content="My first foray into extending Swift&#x27;s Collection protocol in order to provide fast searching of ordered elements."><link rel=author href=/humans.txt><link rel=icon type=image/png href=/images/favicon.png><link rel=stylesheet href=/css/all-219136742a6fdee2bdc61d07f9ed89cc.css></head><body class="post-template nav-closed"><div class="nav nav-closed" id=nav><h3 class=nav-title>Menu</h3><a href=# class=nav-close><span class=hidden>Close</span></a><ul class=nav-list><li class=nav-home role=presentation><a href=/ ><i class="fa fa-home" aria-hidden=true></i> Home</a></li><li class=nav-home role=presentation><a href=/about><i class="fa fa-info-circle" aria-hidden=true></i> About Me</a></li><li class=nav-nome role=presentation><a href=/rss.xml><i class="fa fa-rss" aria-hidden=true></i> Subscribe</a> <a href="https://validator.w3.org/feed/check.cgi?url=https%3A//keystrokecountdown.com/rss.xml"><img src=/images/valid-rss-rogers.png alt="[Valid RSS]" title="Validate my RSS feed"></a></li><li class=nav-home role=presentation><a href=/topics><i class="fa fa-tags" aria-hidden=true></i> Topics</a></li><br><li class=nav-home role=presentation><a href=/articles/auv3/index.html>AUv3 Development -- Part 1 of N</a></li><li class=nav-home role=presentation><a href=/articles/knobci/index.html>Swift Snapshot Testing in Github Actions</a></li><li class=nav-home role=presentation><a href=/articles/wma/index.html>Converting WMA Files to MP3</a></li><li class=nav-home role=presentation><a href=/articles/remarkable/index.html>Remarkable Customizations</a></li><li class=nav-home role=presentation><a href=/articles/browsers/index.html>Automatic Browser Selection</a></li><li class=nav-home role=presentation><a href=/articles/genart/index.html>Generative Images with SVG.js</a></li><li class=nav-home role=presentation><a href=/articles/logistic/index.html>Simple Image Classification using Logistic Regression</a></li><li class=nav-home role=presentation><a href=/articles/kerberos/index.html>Using Kerboros on macOS</a></li><li class=nav-home role=presentation><a href=/articles/translate/index.html>Text Language Translation Utility</a></li><li class=nav-home role=presentation><a href=/articles/keymaps/index.html>Remapping Keys on macOS High Sierra</a></li><li class=nav-home role=presentation><a href=/articles/letencrypt/index.html>Fixing Azure Let&#x27;s Encrypt Expired Key</a></li><li class=nav-home role=presentation><a href=/articles/console/index.html>Formatting Console Output</a></li><li class=nav-home role=presentation><a href=/articles/layout/index.html>[DRAFT] Test Page for CSS Settings</a></li><li class=nav-home role=presentation><a href=/articles/docker/index.html>[DRAFT] Playing with .Net Core Apps and Docker on a Mac</a></li><li class=nav-home role=presentation><a href=/articles/autohotkey/index.html>Different (Key)strokes for Different Folks</a></li><li class=nav-home role=presentation><a href=/articles/itunes/index.html>Apple iTunes Library Manipulation with Python</a></li><li class=nav-home role=presentation><a href=/articles/metalsmith2/index.html>Metalsmith Plugins for Server-side KaTeX Processing</a></li><li class=nav-home role=presentation><a href=/articles/poisson/index.html>Arrival Intervals of a Poisson Process</a></li><li class=nav-home role=presentation><a href=/articles/cocoapods/index.html>Framework Bundles in Xcode and CocoaPods</a></li><li class=nav-home role=presentation><a href=/articles/signing/index.html>Signing Embedded Frameworks in an Embedded Framework</a></li><li class=nav-home role=presentation><a href=/articles/vhtc/index.html>Variable Height UITableView Cells in Swift</a></li><li class=nav-home role=presentation><a href=/articles/joystick/index.html>JoyStickView for iOS in Swift</a></li><li class=nav-home role=presentation><a href=/articles/dependencyInjection/index.html>Dependency Injection for iOS in Swift</a></li><li class=nav-home role=presentation><a href=/articles/corePlot/index.html>Working with Core Plot</a></li><li class=nav-home role=presentation><a href=/articles/slidingViews/index.html>Sliding UIViews with Core Animation</a></li><li class=nav-home role=presentation><a href=/articles/swiftCollection/index.html>Adding Binary Search to Swift Collections</a></li><li class=nav-home role=presentation><a href=/articles/metalsmith/index.html>Metalsmith Static Site on Azure</a></li><li class=nav-home role=presentation><a href=/articles/bloom/index.html>Bloom Filters in Python</a></li><li class=nav-home role=presentation><a href="/articles/Testing IPython/testing-ipython.html">Testing IPython</a></li><li class=nav-home role=presentation><a href=/articles/decrypt/index.html>Decrypting Logs in Python</a></li><li class=nav-home role=presentation><a href=/articles/power/index.html>Power of Optimal Algorithm Design</a></li><li class=nav-home role=presentation><a href=/articles/PDMPlayground/index.html>PDM Playground</a></li><li class=nav-home role=presentation><a href=/articles/bscope/index.html>B-Scope Radar Display</a></li><li class=nav-home role=presentation><a href=/articles/ascope/index.html>A-Scope Signal Display</a></li><li class=nav-home role=presentation><a href=/articles/radardisplay/index.html>Radar Display</a></li><li class=nav-home role=presentation><a href=/articles/dfwtraffic/index.html>Visualizing Traffic at DFW Airport</a></li></ul></div><span class=nav-cover></span><div class=site-wrapper><header class="main-header post-head" style="background-image: url(/articles/swiftCollection/header.png)"><nav class="main-nav overlay clearfix"><a class="menu-button icon-menu" href=#><span class=word>Menu</span></a></nav></header><main class=content role=main><article class=post><header class=post-header><h1 class=post-title><a href=/ >Adding Binary Search to Swift Collections</a></h1><section class=post-meta><time class=post-date datetime="Fri Sep 23 2016 12:18:02 GMT+0200 (Central European Summer Time)">Sep 23rd, 2016</time> <a class=post-date href=/topics><i class="fa fa-tags" aria-hidden=true></i></a> <a class=post-date href=/topics/algorithms.html>Algorithms (3)</a> • <a class=post-date href=/topics/swift.html>Swift (10)</a></section></header><section class=post-content><p><a href=http://swift.org>Swift</a> is a great programming language. I’ve been working in Swift off and on for the past year or so, but with the release of v3.0 of the language, I’ve been spending a lot more time with it. I’m currently rewriting in Swift some of my older Objective-C iOS apps. Some of the code has not been touched since iOS 4/5 time-frame, which makes for some interesting reading.</p><p>In one of my projects, I have an array of samples taken over time, and the items in the array are ordered by an increasing timestamp value. Naturally, these samples are just appended to a Swift <a href=http://swiftdoc.org/v3.0/type/Array>Array</a></p><pre class=language-swift><code class=language-swift><span class="token keyword">var</span> samples<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Sample</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">var</span> sample <span class="token operator">=</span> <span class="token class-name">Sample</span><span class="token punctuation">(</span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
samples<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>sample<span class="token punctuation">)</span>
</code></pre><p>In my app, I have a scatter plot which shows the samples, the horizontal (X) axis being time and the vertical (Y) axis showing the sampled value. As the user swipes the plot to see a different window of points, I wanted to adjust the bounds of the Y axis so that the points were optimally displayed in the available pixels. To do this, I needed to quickly locate two sample points in the data set, the first/last ones to appear in the view port. Between these two points I then locate the min/max value and update the Y axis bounds as appropriate.</p><p>A fast way to locate items in an ordered collection is to use binary search, which gives <strong>O(log N)</strong> performance <sup class=footnote-ref><a href=#fn1 id=fnref1>[1]</a></sup>. This is a simple thing to do, though with Swift <a href=http://swiftdoc.org/v3.0/protocol/Collection>Collection</a> indices there are some subtleties to abide by.</p><pre class=language-swift><code class=language-swift><span class="token keyword">extension</span> <span class="token class-name">Collection</span> <span class="token punctuation">{</span>
    <span class="token keyword">typealias</span> <span class="token class-name">OrderPredicate</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Iterator</span><span class="token punctuation">.</span><span class="token class-name">Element</span><span class="token punctuation">,</span> <span class="token class-name">Iterator</span><span class="token punctuation">.</span><span class="token class-name">Element</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Bool</span>
    <span class="token keyword">func</span> <span class="token function-definition function">insertionIndexOf</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token class-name">Iterator</span><span class="token punctuation">.</span><span class="token class-name">Element</span><span class="token punctuation">,</span> predicate<span class="token punctuation">:</span> <span class="token class-name">OrderPredicate</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Index</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> low <span class="token operator">=</span> startIndex
        <span class="token keyword">var</span> high <span class="token operator">=</span> endIndex
        <span class="token keyword">while</span> low <span class="token operator">!=</span> high <span class="token punctuation">{</span>
            <span class="token keyword">let</span> mid <span class="token operator">=</span> <span class="token function">index</span><span class="token punctuation">(</span>low<span class="token punctuation">,</span> offsetBy<span class="token punctuation">:</span> <span class="token function">distance</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> low<span class="token punctuation">,</span> to<span class="token punctuation">:</span> high<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token function">predicate</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                low <span class="token operator">=</span> <span class="token function">index</span><span class="token punctuation">(</span>mid<span class="token punctuation">,</span> offsetBy<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token punctuation">{</span>
                high <span class="token operator">=</span> mid
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> low
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>The new function <code>insertionIndexOf</code> locates the point in a collection to insert a given value such that the collection still remains sorted after the insertion takes place. Note that the function can return a position that is at the end of the collection – in other words, equal to the size of the collection – when all items in the collection are ordered before the value given to the function. The interesting bit about <code>Collection</code> indices is that they do not have to be integers. Thus, we cannot use normal math operations on them. Instead we need to use methods such as <code>distance</code> and <code>index</code> to generate new indices from old ones.</p><h2>Collection Membership Checking</h2><p>We can use the above <code>insertionIndexOf</code> method to provide a quick check whether a given value is held in a collection. All we need to do is make sure that the index returned from <code>insertionIndexOf</code> points to an element in the collection and that the value it points to matches the one that was given. Below is a definition for a function <code>binarySearchFor</code> which does just that, returning <code>true</code> if the given value was found in the collection.</p><pre class=language-swift><code class=language-swift><span class="token keyword">extension</span> <span class="token class-name">Collection</span> <span class="token keyword">where</span> <span class="token class-name">Iterator</span><span class="token punctuation">.</span><span class="token class-name">Element</span><span class="token punctuation">:</span> <span class="token class-name">Equatable</span> <span class="token punctuation">{</span>
    <span class="token keyword">func</span> <span class="token function-definition function">binarySearchFor</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token class-name">Iterator</span><span class="token punctuation">.</span><span class="token class-name">Element</span><span class="token punctuation">,</span> predicate<span class="token punctuation">:</span> <span class="token class-name">OrderPredicate</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Bool</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> pos <span class="token operator">=</span> <span class="token function">insertionIndexOf</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> value<span class="token punctuation">,</span> predicate<span class="token punctuation">:</span> predicate<span class="token punctuation">)</span>
        <span class="token keyword">return</span> pos <span class="token operator">&lt;</span> endIndex <span class="token operator">&amp;&amp;</span> <span class="token keyword">self</span><span class="token punctuation">[</span>pos<span class="token punctuation">]</span> <span class="token operator">==</span> value
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Note that we cannot just add <code>binarySearchFor</code> to the <code>Collection</code> type like we did for <code>insertionIndexOf</code> because the <code>binarySearchFor</code> function requires the ability to test for equality between elements in the collection. Therefore, we must constrain the extension to only those collections that contains element types that implement the <a href=http://swiftdoc.org/v3.0/protocol/Equatable>Equatable</a> protocol.</p><h2>MinMax on a Collection</h2><p>Since we are having so much fun, here is a simple implementation of a <code>minMax</code> function for <code>Collection</code> types. One could easily calculate this by doing to iterations over the collection like so:</p><pre class=language-swift><code class=language-swift><span class="token keyword">let</span> minValue <span class="token operator">=</span> samples<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> maxValue <span class="token operator">=</span> samples<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><p>However, we can do better by determining the min/max values in one pass. In the implementation below, <code>minMax</code> will return a 2-tuple containing the minimum and maximum values of a collection. If the collection is empty, then <code>minMax</code> will return nil. For non-empty collections, we take the first value as the min/max values and then we iterate over the rest of the elements and look for lesser/greater values.</p><pre class=language-swift><code class=language-swift><span class="token keyword">extension</span> <span class="token class-name">Collection</span> <span class="token keyword">where</span> <span class="token class-name">Iterator</span><span class="token punctuation">.</span><span class="token class-name">Element</span><span class="token punctuation">:</span> <span class="token class-name">Comparable</span> <span class="token punctuation">{</span>
    <span class="token keyword">func</span> <span class="token function-definition function">minMax</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">(</span>min<span class="token punctuation">:</span> <span class="token class-name">Iterator</span><span class="token punctuation">.</span><span class="token class-name">Element</span><span class="token punctuation">,</span> max<span class="token punctuation">:</span> <span class="token class-name">Iterator</span><span class="token punctuation">.</span><span class="token class-name">Element</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
        <span class="token keyword">guard</span> <span class="token keyword">let</span> value <span class="token operator">=</span> first <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token nil constant">nil</span> <span class="token punctuation">}</span>
        <span class="token keyword">var</span> min <span class="token operator">=</span> value
        <span class="token keyword">var</span> max <span class="token operator">=</span> value
        <span class="token keyword">var</span> pos <span class="token operator">=</span> <span class="token function">index</span><span class="token punctuation">(</span>after<span class="token punctuation">:</span> startIndex<span class="token punctuation">)</span>
        <span class="token keyword">while</span> pos <span class="token operator">&lt;</span> endIndex <span class="token punctuation">{</span>
            <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">[</span>pos<span class="token punctuation">]</span>
            <span class="token keyword">if</span> value <span class="token operator">&lt;</span> min <span class="token punctuation">{</span> min <span class="token operator">=</span> value <span class="token punctuation">}</span>
            <span class="token keyword">if</span> value <span class="token operator">></span> max <span class="token punctuation">{</span> max <span class="token operator">=</span> value <span class="token punctuation">}</span>
            pos <span class="token operator">=</span> <span class="token function">index</span><span class="token punctuation">(</span>after<span class="token punctuation">:</span> pos<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>min<span class="token punctuation">:</span> min<span class="token punctuation">,</span> max<span class="token punctuation">:</span> max<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre><p>Note that here we require (constrain) that the collection holds elements which implement the <a href=http://swiftdoc.org/v3.0/protocol/Comparable>Comparable</a> protocol so that we can determine if one value is greater than another.</p><hr class=footnotes-sep><section class=footnotes><ol class=footnotes-list><li id=fn1 class=footnote-item><p>Actual performance depends on implementation of the <code>index</code> and <code>distance</code> methods. Types that support <a href=http://swiftdoc.org/v3.0/protocol/RandomAccessCollection>RandomAccessCollection</a> protocol have <strong>O(1)</strong>* implementations for these methods. Since the <a href=http://swiftdoc.org/v3.0/type/Array>Array</a> type implements <code>RandomAccessCollection</code>, it will have true <strong>O(log N)</strong> binary search performance. <a href=#fnref1 class=footnote-backref>↩</a></p></li></ol></section></section><footer class=post-footer><figure class=author-image><a class=img href=https://keystrokecountdown.com style=background-image:url(/images/HarrisonsLaugh.png)><span class=hidden>Brad Howes's Picture</span></a></figure><section class=author><h4><a href=https://keystrokecountdown.com>Brad Howes</a></h4><p>Owner <a href=https://apps.apple.com/us/developer/b-ray-software/id430573224>B-Ray Software</a>. Programmer in C++, Swift, Python, Javascript and more. Started out doing punch cards in FORTRAN.</p><div class=author-meta><span class="author-location icon-location">Paris, France</span> <span class="author-link icon-link"><a href=http://linkedin.com/in/bradhowes>http://linkedin.com/in/bradhowes</a></span> <span class="author-link icon-feed"><a href=mailto:bradhowes@mac.com>&nbsp;Email Me</a></span></div></section><section class=share><h4>Share this page</h4><div class=social-icons><a class=icon-twitter href="https://twitter.com/intent/tweet?text=Adding%20Binary%20Search%20to%20Swift%20Collections&amp;url=https%3A%2Fkeystrokecountdown.com%2Farticles%2FswiftCollection%2Findex.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;"><span class=hidden>Twitter</span> </a><a class=icon-feed href="mailto:bradhowes@mac.com?subject=Curiosity&body=https%3A%2Fkeystrokecountdown.com%2Farticles%2FswiftCollection%2Findex.html"><span class=hidden>Email</span></a></div></section></footer></article></main><aside class=read-next><a class=read-next-story style="background-image: url(/articles/metalsmith/computer-keyboard-stones-on-grass-background-header.jpg)" href=/articles/metalsmith/index.html><section class=post><h2>Metalsmith Static Site on Azure</h2><div class=post-meta>Where I describe how I use Metalsmith to run a static site blog on Azure</div></section></a><a class="read-next-story prev" style="background-image: url(/articles/slidingViews/animation.gif)" href=/articles/slidingViews/index.html><section class=post><h2>Sliding UIViews with Core Animation</h2><div class=post-meta>Shows how to easily animate sliding UIViews for a nice visual effect</div></section></a></aside><footer class="site-footer clearfix"><section class=copyright><a href=https://keystrokecountdown.com>Keystroke Countdown</a> &copy; <span id=copyrightYear>2016</span> Brad Howes — <a href=https://github.com/bradhowes/keystrokecountdown>Source</a></section></footer></div><script>(function () {
      var installClickHandlers = function () {
        var navElement = document.getElementById("nav");
    
        // The click handler just toggles classes to do the showing/hiding
        //
        var clickHandler = function(e) {
          document.body.classList.toggle("nav-opened");
          document.body.classList.toggle("nav-closed");
          if (navElement) {
            navElement.classList.toggle("nav-opened");
            navElement.classList.toggle("nav-closed");
          }
        };
    
        // Find elements we wish to tap for click events
        //
        var elements = Array.prototype.slice.call(
          document.querySelectorAll(".menu-button, .nav-cover, .nav-close"));
        if (elements && elements.length > 0) {
          elements.forEach(function (element) {
            element.addEventListener('click', clickHandler);
          });
        }
      };
    
      // When the document is finished loading, install event handlers to show/hide sidebar menu
      //
      window.document.addEventListener("DOMContentLoaded", function (event) {
        installClickHandlers();
    
        // Set the copyright year at the bottom of our pages
        //
        window.document.getElementById("copyrightYear").innerHTML = (new Date()).getFullYear();
      });
    })();</script></body></html>